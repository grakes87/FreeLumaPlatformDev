---
phase: 09-platform-refinements-and-admin-tools
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/db/migrations/071-remove-haha-from-prayer-daily.cjs
  - src/lib/utils/constants.ts
  - src/components/daily/ReactionPicker.tsx
  - src/components/daily/QuickReactionPicker.tsx
  - src/components/prayer/PrayerCard.tsx
  - src/components/profile/ProfileGridItem.tsx
  - src/app/(admin)/admin/videos/page.tsx
autonomous: true

must_haves:
  truths:
    - "Haha reaction no longer appears in daily content reaction pickers"
    - "Haha reaction no longer appears in prayer wall reaction components"
    - "Post reactions still show all 6 reaction types including haha"
    - "Repost cards in profile grid display view count badges"
    - "Video thumbnail regeneration button appears for all videos in admin"
  artifacts:
    - path: "src/lib/db/migrations/071-remove-haha-from-prayer-daily.cjs"
      provides: "Migration to delete existing haha reactions from daily_reactions and prayer post_reactions"
    - path: "src/lib/utils/constants.ts"
      provides: "PRAYER_REACTION_TYPES and DAILY_REACTION_TYPES filtered arrays without haha"
      contains: "PRAYER_REACTION_TYPES"
    - path: "src/components/profile/ProfileGridItem.tsx"
      provides: "View count badge on repost grid items"
      contains: "reposts"
  key_links:
    - from: "src/components/daily/ReactionPicker.tsx"
      to: "src/lib/utils/constants.ts"
      via: "DAILY_REACTION_TYPES import"
      pattern: "DAILY_REACTION_TYPES"
    - from: "src/components/daily/QuickReactionPicker.tsx"
      to: "src/lib/utils/constants.ts"
      via: "DAILY_REACTION_TYPES import"
      pattern: "DAILY_REACTION_TYPES"
    - from: "src/components/prayer/PrayerCard.tsx"
      to: "src/lib/utils/constants.ts"
      via: "PRAYER_REACTION_TYPES import"
      pattern: "PRAYER_REACTION_TYPES"
---

<objective>
Remove haha reactions from prayer wall and daily content, add view count badges to repost grid items, and make video thumbnail regeneration available for all videos in admin.

Purpose: Three targeted UX refinements that are small, independent, and can be combined into one plan without risk.
Output: Migration file, updated constants, updated UI components.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-platform-refinements-and-admin-tools/09-RESEARCH.md

@src/lib/utils/constants.ts
@src/components/daily/ReactionPicker.tsx
@src/components/daily/QuickReactionPicker.tsx
@src/components/prayer/PrayerCard.tsx
@src/components/profile/ProfileGridItem.tsx
@src/app/(admin)/admin/videos/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove haha reactions from prayer and daily content</name>
  <files>
    src/lib/db/migrations/071-remove-haha-from-prayer-daily.cjs
    src/lib/utils/constants.ts
    src/components/daily/ReactionPicker.tsx
    src/components/daily/QuickReactionPicker.tsx
    src/components/prayer/PrayerCard.tsx
  </files>
  <action>
1. Create migration `src/lib/db/migrations/071-remove-haha-from-prayer-daily.cjs`:
   - `up`: DELETE FROM daily_reactions WHERE reaction_type = 'haha'
   - `up`: DELETE FROM post_reactions pr INNER JOIN posts p ON pr.post_id = p.id WHERE pr.reaction_type = 'haha' AND p.post_type = 'prayer_request'
   - `down`: empty (cannot restore deleted reactions)
   - Do NOT alter the ENUM -- leave 'haha' as a valid but unused value in the column definition

2. In `src/lib/utils/constants.ts`:
   - Add two new exported filtered arrays AFTER the existing REACTION_TYPES:
     ```
     export const PRAYER_REACTION_TYPES = REACTION_TYPES.filter(t => t !== 'haha');
     export const DAILY_REACTION_TYPES = REACTION_TYPES.filter(t => t !== 'haha');
     ```
   - These are typed subsets, not new types -- they use the same ReactionType union

3. In `src/components/daily/ReactionPicker.tsx`:
   - Change the import from REACTION_TYPES to DAILY_REACTION_TYPES
   - Replace usage of REACTION_TYPES with DAILY_REACTION_TYPES in the component

4. In `src/components/daily/QuickReactionPicker.tsx`:
   - Change the import from REACTION_TYPES to DAILY_REACTION_TYPES
   - Replace usage of REACTION_TYPES with DAILY_REACTION_TYPES in the component

5. In `src/components/prayer/PrayerCard.tsx`:
   - Find where REACTION_TYPES is used for the prayer reaction picker/display
   - Replace with PRAYER_REACTION_TYPES import and usage
   - If PrayerCard uses a shared reaction component with a types prop, pass PRAYER_REACTION_TYPES as the types prop instead

6. Run migration: `npx sequelize-cli db:migrate --env development`

IMPORTANT: Do NOT modify post reaction components (PostReactionPicker, PostReactionBar) -- posts keep all 6 reaction types.
  </action>
  <verify>
    - Migration runs without errors: `npx sequelize-cli db:migrate --env development`
    - `SELECT COUNT(*) FROM daily_reactions WHERE reaction_type = 'haha'` returns 0
    - `SELECT COUNT(*) FROM post_reactions pr JOIN posts p ON pr.post_id = p.id WHERE pr.reaction_type = 'haha' AND p.post_type = 'prayer_request'` returns 0
    - Grep for DAILY_REACTION_TYPES in daily components shows proper usage
    - Grep for PRAYER_REACTION_TYPES in prayer components shows proper usage
    - Grep for REACTION_TYPES in post components (PostReactionPicker, PostReactionBar) still uses full list
  </verify>
  <done>Haha reaction is removed from prayer wall and daily content pickers. Existing haha reaction data is deleted from those contexts. Post reactions remain unchanged with all 6 types.</done>
</task>

<task type="auto">
  <name>Task 2: Add view count badges to repost grid items and video thumbnail regen button</name>
  <files>
    src/components/profile/ProfileGridItem.tsx
    src/app/(admin)/admin/videos/page.tsx
  </files>
  <action>
1. In `src/components/profile/ProfileGridItem.tsx`:
   - The existing view count badge condition is:
     ```
     {tab === 'posts' && isVideo && (
     ```
   - Change it to show the badge for reposts too, and for ANY content (not just videos):
     ```
     {(tab === 'posts' || tab === 'reposts') && viewCount > 0 && (
     ```
   - This shows the eye+count badge on repost grid items. The view_count data is ALREADY returned by the profile API for reposts (confirmed in research on lines 472/479 of the profile API).

2. In `src/app/(admin)/admin/videos/page.tsx`:
   - Find the thumbnail retry button which is currently conditionally rendered:
     ```
     {!video.thumbnail_url && (
     ```
   - Change to always show the button (remove the `!video.thumbnail_url` condition):
     ```
     <button
       type="button"
       onClick={() => handleRetryThumbnail(video)}
       ...
     ```
   - This allows admins to regenerate thumbnails for ALL videos, not just those missing thumbnails.
   - Update the title attribute from "Retry thumbnail" to "Regenerate thumbnail" for clarity.
  </action>
  <verify>
    - In ProfileGridItem.tsx, grep for `reposts` in the view count badge section confirms condition includes reposts tab
    - In admin videos page, the RefreshCw button is no longer wrapped in `!video.thumbnail_url` conditional
    - `npx next build` compiles without TypeScript errors in these files
  </verify>
  <done>Repost cards in profile grid show view count badges (eye icon + count) when view_count > 0. Video thumbnail regeneration button is visible for all videos in admin, not just those missing thumbnails.</done>
</task>

</tasks>

<verification>
- Migration 071 applied successfully
- No haha reactions remain in daily_reactions or prayer-related post_reactions
- Post reactions still have all 6 types (including haha)
- Profile grid reposts tab shows view counts
- Admin video page shows regen thumbnail button for all videos
- `npx next build` succeeds
</verification>

<success_criteria>
1. Haha reaction removed from prayer wall and daily content UI pickers
2. Existing haha reactions deleted via migration from daily_reactions and prayer post_reactions
3. Post feed reactions unchanged (all 6 types)
4. Repost grid items show view count badges
5. All videos in admin show thumbnail regeneration button
</success_criteria>

<output>
After completion, create `.planning/phases/09-platform-refinements-and-admin-tools/09-01-SUMMARY.md`
</output>
