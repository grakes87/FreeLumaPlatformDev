---
phase: 09-platform-refinements-and-admin-tools
plan: 06
type: execute
wave: 2
depends_on: ["09-04"]
files_modified:
  - src/components/admin/FontFamilySection.tsx
  - src/components/admin/AdminSettings.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can configure a font family for each text field category independently"
    - "Font picker dropdown shows each font name rendered in its own typeface"
    - "Font picker has category filter tabs (Serif, Sans-Serif, Display, Handwriting, Monospace)"
    - "Font picker has search input to filter fonts by name"
    - "Text fields are grouped under collapsible sections (Navigation, Headings, Feed, etc.)"
    - "Each field has a reset-to-default button, plus a global Reset All button"
    - "Admin sees live preview of sample text as they select fonts"
    - "Preview + Publish flow: admin reviews changes before saving to platform settings"
    - "Admin page loads all 100 fonts for preview"
    - "Publishing saves font_config as JSON to PlatformSetting and immediately applies to all users"
  artifacts:
    - path: "src/components/admin/FontFamilySection.tsx"
      provides: "Full font configuration UI with picker, preview, section grouping"
      min_lines: 200
    - path: "src/components/admin/AdminSettings.tsx"
      provides: "FontFamilySection integrated as collapsible section in admin settings"
      contains: "FontFamilySection"
  key_links:
    - from: "src/components/admin/FontFamilySection.tsx"
      to: "src/lib/fonts/google-fonts.ts"
      via: "CURATED_FONTS for dropdown options"
      pattern: "CURATED_FONTS"
    - from: "src/components/admin/FontFamilySection.tsx"
      to: "src/lib/fonts/font-fields.ts"
      via: "FONT_SECTIONS for field grouping"
      pattern: "FONT_SECTIONS"
    - from: "src/components/admin/FontFamilySection.tsx"
      to: "/api/platform-settings"
      via: "PUT to save font_config"
      pattern: "font_config"
---

<objective>
Build the admin font family configuration UI with searchable, category-filtered font picker, per-field assignment, collapsible section grouping, live preview, and publish flow.

Purpose: Allows admin to customize the app's typography per text field category, with visual preview before publishing to all users.
Output: FontFamilySection component integrated into AdminSettings.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-platform-refinements-and-admin-tools/09-RESEARCH.md
@.planning/phases/09-platform-refinements-and-admin-tools/09-04-SUMMARY.md

@src/lib/fonts/google-fonts.ts
@src/lib/fonts/font-fields.ts
@src/components/admin/AdminSettings.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: FontFamilySection component with font picker and preview</name>
  <files>
    src/components/admin/FontFamilySection.tsx
  </files>
  <action>
Create `src/components/admin/FontFamilySection.tsx` -- a comprehensive font configuration component.

**Component Architecture:**

1. **FontPicker sub-component** (inline, not separate file):
   - Searchable dropdown rendered as a custom select/popover
   - Props: `value: string`, `onChange: (family: string) => void`, `label: string`, `sampleText: string`
   - When closed: shows the current font name (or "Default" if empty/inherit) + a small sample text preview in that font
   - When open: full dropdown with:
     - Search input at top (filters CURATED_FONTS by family name, case-insensitive)
     - Category filter tabs below search: All | Sans-Serif | Serif | Display | Handwriting | Monospace
     - Scrollable font list (max-height ~300px, overflow-y-auto)
     - Each font item: font family name rendered in its OWN typeface (style={{ fontFamily: `'${font.family}', ${font.category}` }})
     - Clicking a font selects it and closes dropdown
   - Include a "Reset to Default" button (X icon) next to the current value that clears the selection

2. **Section grouping:**
   - Import FONT_SECTIONS from font-fields.ts
   - Render each section as a collapsible group (click to expand/collapse):
     - Section header with chevron icon (ChevronDown/ChevronUp) and section title
     - When expanded: list of FontPicker components for each field in the section
     - Default state: first section expanded, rest collapsed

3. **Live preview:**
   - Each FontPicker shows its sample text (from FontField.sampleText) rendered in the selected font
   - As admin selects fonts, the sample text updates immediately
   - A "Preview Summary" area at the bottom shows all configured fields with their sample text in the selected fonts

4. **State management:**
   - `draftConfig: Record<string, string>` -- local state for unsaved changes
   - `savedConfig: Record<string, string>` -- last saved state (from platform settings)
   - `hasChanges: boolean` -- computed: draftConfig differs from savedConfig
   - Load initial state from platform settings API on mount (GET /api/platform-settings, parse font_config)

5. **Publish flow:**
   - "Publish Changes" button (primary, at bottom) -- only enabled when hasChanges is true
   - "Reset All" button (secondary, destructive) -- clears ALL field selections back to default
   - On publish: PUT /api/platform-settings with key='font_config', value=JSON.stringify(draftConfig)
   - On success: toast "Font settings published", update savedConfig
   - On error: toast error message

6. **Admin-only font loading:**
   - On mount, inject a `<link>` tag to load ALL 100 curated fonts from Google Fonts CSS2 API
   - Build URL: `https://fonts.googleapis.com/css2?` + all 100 families with wght@400;700 + `&display=swap`
   - This is admin-only (not in main app) so the large font load is acceptable
   - Use useEffect with cleanup to add/remove the link tag
   - The URL will be long but Google Fonts CSS2 supports it

7. **Unsaved changes warning:**
   - If hasChanges is true and admin tries to navigate away, show a confirmation (optional, nice-to-have, not critical)

**Styling:**
- Match AdminSettings SettingsGroup pattern: rounded-xl cards with border
- FontPicker dropdown: absolute positioned, z-50, bg-surface, border, shadow-lg, rounded-xl
- Selected font highlighted with bg-primary/10
- Category tabs: small pill buttons matching existing tab pattern
- Use cn() for all class merging
- Icons: Type (for section header), Search, X, ChevronDown, ChevronUp from lucide-react

**Props interface:**
```typescript
interface FontFamilySectionProps {
  // No props needed -- self-contained, fetches own data
}
```
  </action>
  <verify>
    - Component renders without errors
    - All 7 sections visible (expandable/collapsible)
    - FontPicker opens dropdown with search and category filters
    - Each font name rendered in its own typeface
    - Sample text previews update when font selected
    - Publish saves to platform settings API
    - Reset All clears all selections
    - Per-field reset (X) clears individual selections
    - `npx next build` compiles successfully
  </verify>
  <done>FontFamilySection provides full per-field font configuration with searchable categorized picker, live preview, and publish flow.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate FontFamilySection into AdminSettings</name>
  <files>
    src/components/admin/AdminSettings.tsx
  </files>
  <action>
1. Import FontFamilySection and the Type icon from lucide-react at the top of AdminSettings.tsx

2. Add a new collapsible section for Font Family AFTER the existing "Mode Isolation" section and BEFORE the closing `</div>`:

   Add state for section collapsed/expanded:
   ```
   const [fontSectionOpen, setFontSectionOpen] = useState(false);
   ```

   Render:
   ```jsx
   {/* Font Family Configuration */}
   <div className="space-y-3">
     <button
       onClick={() => setFontSectionOpen(!fontSectionOpen)}
       className="flex w-full items-center gap-2"
     >
       <Type className="h-5 w-5 text-text-muted dark:text-text-muted-dark" />
       <h3 className="font-semibold text-text dark:text-text-dark">Font Family</h3>
       <span className="ml-auto text-text-muted dark:text-text-muted-dark">
         {fontSectionOpen ? <ChevronUp className="h-4 w-4" /> : <ChevronDown className="h-4 w-4" />}
       </span>
     </button>
     <p className="text-sm text-text-muted dark:text-text-muted-dark">
       Configure font families for different text elements across the app.
     </p>
     {fontSectionOpen && <FontFamilySection />}
   </div>
   ```

3. Import ChevronDown, ChevronUp from lucide-react if not already imported.

4. The FontFamilySection is self-contained -- it handles its own data fetching, state, and saving. It does NOT use the parent AdminSettings handleChange function (since font_config is a JSON blob, not a simple key-value toggle).
  </action>
  <verify>
    - AdminSettings page shows "Font Family" collapsible section
    - Clicking the section header expands/collapses the FontFamilySection
    - FontFamilySection loads and functions within AdminSettings
    - Other settings sections still work correctly
    - `npx next build` compiles without errors
  </verify>
  <done>FontFamilySection integrated as a collapsible section within admin platform settings page.</done>
</task>

</tasks>

<verification>
- Admin settings page shows Font Family section
- Section expands to show font configuration grouped by text field categories
- Font picker dropdown shows 100 fonts with search and category filters
- Each font name rendered in its own typeface
- Sample text previews work
- Publishing saves font_config to platform settings
- FontLoader on main app picks up and applies the published fonts
- Reset All and per-field reset work
- `npx next build` succeeds
</verification>

<success_criteria>
1. Admin can configure font family for each of 16 text field categories
2. Searchable dropdown with fonts rendered in their own typeface
3. Category filter tabs: Serif / Sans-Serif / Display / Handwriting / Monospace
4. Fields grouped under 7 collapsible sections
5. Per-field reset + global Reset All
6. Live sample text preview
7. Publish saves to PlatformSetting, immediately affects all users
8. Collapsible section in admin settings (not a separate page)
</success_criteria>

<output>
After completion, create `.planning/phases/09-platform-refinements-and-admin-tools/09-06-SUMMARY.md`
</output>
