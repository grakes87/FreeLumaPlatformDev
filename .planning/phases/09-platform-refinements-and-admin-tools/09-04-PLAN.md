---
phase: 09-platform-refinements-and-admin-tools
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/fonts/google-fonts.ts
  - src/lib/fonts/font-fields.ts
  - src/components/layout/FontLoader.tsx
  - src/hooks/usePlatformSettings.ts
  - src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Curated list of 100 Google Fonts exists as static data with categories"
    - "Text field categories are defined and grouped by section"
    - "FontLoader component loads only the selected fonts at runtime via Google Fonts CSS2"
    - "CSS custom properties are set for each font field (--font-field-name)"
    - "usePlatformSettings exposes fontConfig getter for font configuration"
    - "Main app preconnects to Google Fonts on initial load"
    - "No performance degradation -- only selected fonts loaded, not all 100"
  artifacts:
    - path: "src/lib/fonts/google-fonts.ts"
      provides: "Curated list of 100 Google Fonts with family and category metadata"
      exports: ["CURATED_FONTS", "GoogleFont"]
    - path: "src/lib/fonts/font-fields.ts"
      provides: "Text field categories grouped by section, with CSS variable names and defaults"
      exports: ["FONT_FIELDS", "FONT_SECTIONS", "FontField"]
    - path: "src/components/layout/FontLoader.tsx"
      provides: "Client component that injects Google Fonts CSS link and CSS variables"
      exports: ["FontLoader"]
    - path: "src/hooks/usePlatformSettings.ts"
      provides: "fontConfig convenience getter added to existing hook"
      contains: "fontConfig"
    - path: "src/app/layout.tsx"
      provides: "Preconnect links for Google Fonts in head"
      contains: "fonts.googleapis.com"
  key_links:
    - from: "src/components/layout/FontLoader.tsx"
      to: "src/hooks/usePlatformSettings.ts"
      via: "usePlatformSettings().fontConfig"
      pattern: "fontConfig"
    - from: "src/components/layout/FontLoader.tsx"
      to: "src/lib/fonts/font-fields.ts"
      via: "FONT_FIELDS for CSS variable names"
      pattern: "FONT_FIELDS"
---

<objective>
Build the font system infrastructure: curated Google Fonts list, text field category definitions, FontLoader component for runtime font loading via CSS variables, and platform settings hook integration.

Purpose: Establishes the data layer and runtime loading mechanism for the per-field font system. The admin UI (Plan 06) builds on this foundation.
Output: Static font data files, FontLoader component, enhanced usePlatformSettings hook, preconnect in layout.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-platform-refinements-and-admin-tools/09-RESEARCH.md

@src/hooks/usePlatformSettings.ts
@src/app/layout.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Curated font list and text field category definitions</name>
  <files>
    src/lib/fonts/google-fonts.ts
    src/lib/fonts/font-fields.ts
  </files>
  <action>
1. Create `src/lib/fonts/google-fonts.ts`:
   - Define interface:
     ```typescript
     export interface GoogleFont {
       family: string;
       category: 'serif' | 'sans-serif' | 'display' | 'handwriting' | 'monospace';
     }
     export type FontCategory = GoogleFont['category'];
     export const FONT_CATEGORIES: FontCategory[] = ['sans-serif', 'serif', 'display', 'handwriting', 'monospace'];
     ```
   - Export `CURATED_FONTS: GoogleFont[]` array with 100 popular Google Fonts
   - Include a balanced mix across categories. Prioritize by popularity on Google Fonts:
     - ~40 sans-serif: Roboto, Open Sans, Lato, Montserrat, Poppins, Nunito, Raleway, Inter, Outfit, Work Sans, Rubik, Karla, Manrope, DM Sans, Plus Jakarta Sans, Figtree, Quicksand, Cabin, Mukta, Source Sans 3, Noto Sans, Barlow, Josefin Sans, Exo 2, Overpass, Saira, Red Hat Display, Lexend, IBM Plex Sans, Archivo, Libre Franklin, Albert Sans, Be Vietnam Pro, Nunito Sans, Ubuntu, Mulish, Kanit, Prompt, Assistant, Urbanist
     - ~25 serif: Playfair Display, Merriweather, Lora, PT Serif, Crimson Text, EB Garamond, Libre Baskerville, Source Serif 4, Cormorant Garamond, Bitter, Vollkorn, Cardo, Noto Serif, DM Serif Display, Spectral, Old Standard TT, Bodoni Moda, Cormorant, Literata, Frank Ruhl Libre, Mate, IBM Plex Serif, Unna, Bree Serif, Eczar
     - ~15 display: Oswald, Bebas Neue, Lobster, Abril Fatface, Righteous, Fredoka, Bungee, Titan One, Passion One, Permanent Marker, Alfa Slab One, Audiowide, Orbitron, Concert One, Rubik Mono One
     - ~15 handwriting: Dancing Script, Pacifico, Caveat, Satisfy, Great Vibes, Sacramento, Kalam, Indie Flower, Shadows Into Light, Patrick Hand, Amatic SC, Courgette, Cookie, Gloria Hallelujah, Handlee
     - ~5 monospace: Fira Code, JetBrains Mono, Source Code Pro, IBM Plex Mono, Space Mono
   - Each entry is just `{ family: 'Name', category: 'sans-serif' }`
   - Sort alphabetically within each category

2. Create `src/lib/fonts/font-fields.ts`:
   - Define interfaces:
     ```typescript
     export interface FontField {
       key: string;          // e.g., 'nav_labels'
       label: string;        // e.g., 'Navigation Labels'
       cssVar: string;       // e.g., '--font-nav-labels'
       description: string;  // e.g., 'Bottom nav tab labels, top bar title'
       sampleText: string;   // e.g., 'Daily Feed Prayer'
     }

     export interface FontSection {
       title: string;
       fields: FontField[];
     }
     ```
   - Export `FONT_SECTIONS: FontSection[]` organized into groups.

   Based on codebase audit, define these sections and fields:

   **Navigation** (bottom nav, top bar):
   - `nav_labels` -- "Navigation Labels" -- Bottom nav tab labels, top bar title -- sample: "Feed Prayer Watch Profile"

   **Headings** (page titles, section headers):
   - `page_titles` -- "Page Titles" -- Main page headings (h1) -- sample: "Prayer Wall"
   - `section_headers` -- "Section Headers" -- Card section titles, group headers (h2/h3) -- sample: "Trending Today"

   **Feed** (post cards, feed content):
   - `feed_username` -- "Feed Usernames" -- Usernames and display names on post cards -- sample: "@freeluma"
   - `feed_body` -- "Feed Post Body" -- Post text content in feed cards -- sample: "God is good all the time..."
   - `feed_meta` -- "Feed Metadata" -- Timestamps, reaction counts, comment counts -- sample: "2h ago  12 likes  3 comments"

   **Daily Post** (daily content slides):
   - `daily_verse` -- "Daily Verse/Quote" -- Main verse or quote text on daily post -- sample: "For God so loved the world..."
   - `daily_reference` -- "Daily Reference" -- Bible chapter reference or attribution -- sample: "John 3:16 (NIV)"
   - `daily_subtitle` -- "Daily Subtitles" -- Audio/video subtitle overlay text -- sample: "The Lord is my shepherd"

   **Prayer Wall**:
   - `prayer_body` -- "Prayer Request Body" -- Prayer request text content -- sample: "Please pray for my family..."
   - `prayer_meta` -- "Prayer Metadata" -- Prayer counts, supporter info -- sample: "24 people praying"

   **Profile**:
   - `profile_name` -- "Profile Display Name" -- User display name on profile page -- sample: "John Smith"
   - `profile_bio` -- "Profile Bio" -- User bio text -- sample: "Grateful for every blessing"
   - `profile_stats` -- "Profile Stats" -- Follower/following/post counts -- sample: "42 Posts  128 Followers"

   **General**:
   - `body_default` -- "Body Text Default" -- General body text, fallback font -- sample: "Welcome to Free Luma"
   - `button_labels` -- "Button Labels" -- Button text across the app -- sample: "Follow  Message  Share"

   - Export flat helper: `FONT_FIELDS: FontField[]` = all fields from all sections flattened
   - Export helper: `DEFAULT_FONT = 'inherit'` (each field defaults to inherit, meaning the system font)
   - Export helper: `buildFontConfig(overrides: Record<string, string>): Record<string, string>` that takes partial overrides and fills in defaults
  </action>
  <verify>
    - `src/lib/fonts/google-fonts.ts` exports CURATED_FONTS with exactly 100 entries
    - Each font has family (non-empty string) and category (one of the 5 valid categories)
    - `src/lib/fonts/font-fields.ts` exports FONT_SECTIONS with grouped fields
    - FONT_FIELDS flat array has 16 entries matching the sections
    - All fields have key, label, cssVar, description, sampleText
    - TypeScript compiles: `npx tsc --noEmit src/lib/fonts/google-fonts.ts src/lib/fonts/font-fields.ts`
  </verify>
  <done>100 curated Google Fonts defined with categories. 16 text field categories defined across 7 sections with CSS variable names, labels, and sample text.</done>
</task>

<task type="auto">
  <name>Task 2: FontLoader component, platform settings integration, and layout preconnect</name>
  <files>
    src/components/layout/FontLoader.tsx
    src/hooks/usePlatformSettings.ts
    src/app/layout.tsx
  </files>
  <action>
1. Create `src/components/layout/FontLoader.tsx`:
   - 'use client' component
   - Import usePlatformSettings, FONT_FIELDS from font-fields
   - Read font_config from platform settings via getSetting('font_config')
   - Parse the JSON (with try/catch, default to empty object)
   - Compute unique font families from the config values (filter out empty/inherit)
   - If no custom fonts selected, render nothing
   - Build Google Fonts CSS2 URL:
     ```
     const families = uniqueFonts
       .map(f => `family=${encodeURIComponent(f)}:wght@300;400;500;600;700`)
       .join('&');
     const href = `https://fonts.googleapis.com/css2?${families}&display=swap`;
     ```
   - Render:
     - `<link rel="stylesheet" href={href} />` for the Google Fonts CSS
     - A `<style>` tag (or a wrapper div with inline styles) that sets CSS custom properties on `:root`:
       ```css
       :root {
         --font-nav-labels: 'Roboto', sans-serif;
         --font-page-titles: 'Montserrat', sans-serif;
         /* ... for each configured field */
       }
       ```
     - For each field in FONT_FIELDS, check if fontConfig has a value for that field's key. If so, set `--font-{key with underscores to hyphens}: '{fontFamily}', ${fallbackStack}`. If not, set to `inherit`.
     - Fallback stack: Use the Google Font's category as fallback (serif, sans-serif, etc.). Since we don't have category info in the config, use `sans-serif` as default fallback, or look up the category from CURATED_FONTS.

   - Export the component for use in layout

2. Update `src/hooks/usePlatformSettings.ts`:
   - Add `fontConfig` getter to the return value:
     ```typescript
     const fontConfig: Record<string, string> = useMemo(() => {
       const raw = settings.font_config;
       if (!raw) return {};
       try {
         return JSON.parse(raw);
       } catch {
         return {};
       }
     }, [settings]);
     ```
   - Add to UsePlatformSettingsReturn interface: `fontConfig: Record<string, string>`
   - Add useMemo import if not already imported
   - Return fontConfig in the return object

3. Update `src/app/layout.tsx`:
   - Add Google Fonts preconnect links in the `<head>` section (before any stylesheets):
     ```html
     <link rel="preconnect" href="https://fonts.googleapis.com" />
     <link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin="anonymous" />
     ```
   - Import and render `<FontLoader />` inside the body, after ThemeProvider and before children:
     - FontLoader must be inside any providers that supply platform settings context
     - Check where usePlatformSettings fetches from -- it uses a direct fetch, not context, so FontLoader can go anywhere in the client tree
     - Place it early in the body but after AuthProvider (since platform settings API requires auth)
     - Actually, check if /api/platform-settings requires auth. If it does, FontLoader should go inside the (app) layout, not root layout. If it's public, root layout is fine.
     - Looking at the codebase: platform-settings GET uses withAuth (authenticated only). So FontLoader should go in the authenticated app layout at `src/app/(app)/layout.tsx`, not root layout.
   - CORRECTION: Add preconnect links in root layout head. Add FontLoader in `src/app/(app)/layout.tsx` (the authenticated app shell) so it only runs for logged-in users.
   - Update `src/app/(app)/layout.tsx` to import and render FontLoader

IMPORTANT: The preconnect links go in root layout.tsx `<head>`. The FontLoader component goes in (app)/layout.tsx body. These are two different files.
  </action>
  <verify>
    - FontLoader component exists and compiles
    - usePlatformSettings returns fontConfig property
    - Root layout has preconnect links for fonts.googleapis.com and fonts.gstatic.com
    - (app)/layout.tsx renders FontLoader
    - When font_config is empty/missing, FontLoader renders nothing (no Google Fonts request)
    - When font_config has values, FontLoader generates correct CSS2 URL and CSS variables
    - `npx next build` compiles successfully
  </verify>
  <done>FontLoader component loads only selected fonts at runtime via Google Fonts CSS2 link tags. CSS custom properties set per field. usePlatformSettings exposes fontConfig. Preconnect links in place for optimal loading.</done>
</task>

</tasks>

<verification>
- 100 curated Google Fonts defined with categories
- 16 text field categories across 7 sections
- FontLoader renders CSS link and CSS variables based on font_config platform setting
- No fonts loaded when no config set (no performance impact by default)
- usePlatformSettings.fontConfig works
- Preconnect links in root layout
- `npx next build` succeeds
</verification>

<success_criteria>
1. Static curated font list with 100 fonts across 5 categories
2. 16 configurable text field categories grouped into 7 sections
3. FontLoader dynamically loads only the selected fonts
4. CSS custom properties set on :root for each field
5. No performance degradation when no fonts configured
6. Preconnect links for Google Fonts in document head
</success_criteria>

<output>
After completion, create `.planning/phases/09-platform-refinements-and-admin-tools/09-04-SUMMARY.md`
</output>
