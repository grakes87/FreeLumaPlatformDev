---
phase: 06-bug-fixes
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/prayer/PrayerCard.tsx
  - src/hooks/usePrayerWall.ts
  - src/components/social/PostReactionBar.tsx
autonomous: true

must_haves:
  truths:
    - "Prayer card default reaction icon is an outlined heart (not prayer emoji)"
    - "After selecting a reaction on a prayer card, the selected reaction is visually highlighted"
    - "Marking a prayer request as answered actually updates the database and shows in Answered section"
    - "After creating a new prayer request, it appears in My Requests without manual refresh"
  artifacts:
    - path: "src/components/prayer/PrayerCard.tsx"
      provides: "Fixed prayer card with heart icon and correct mark-answered API payload"
      contains: "action.*mark_answered"
    - path: "src/hooks/usePrayerWall.ts"
      provides: "Auto-switch to My Requests tab after prayer creation"
    - path: "src/components/social/PostReactionBar.tsx"
      provides: "Visible highlight on selected reaction"
  key_links:
    - from: "src/components/prayer/PrayerCard.tsx"
      to: "src/app/api/prayer-requests/[id]/route.ts"
      via: "PATCH body with action: 'mark_answered'"
      pattern: "action.*mark_answered"
    - from: "src/hooks/usePrayerWall.ts"
      to: "tab switch after creation"
      via: "auto-switch to mine tab"
      pattern: "setActiveTab.*mine"
---

<objective>
Fix five prayer wall card bugs: default reaction icon (heart outline), reaction highlight visibility, mark-answered API field mismatch, new request not appearing, and answered prayers not showing.

Purpose: Make prayer wall cards fully functional — reactions work visually, marking answered works end-to-end, and new prayers appear immediately.
Output: Fixed PrayerCard, usePrayerWall hook, and PostReactionBar components.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-bug-fixes/06-RESEARCH.md

Key research findings:
- Bug #9 (Default heart): PrayerCard line 382 uses prayer hands emoji `&#x1F64F;`. Replace with `<Heart className="h-5 w-5" />` from lucide-react.
- Bug #6 (Reaction highlight): PostReactionBar shows subtle `bg-primary/10` when userReaction is set. The highlight is too subtle — add a more visible indicator (ring, scale, or different background) to the user's selected reaction.
- Bug #10 (Answered prayers): Client sends `{ mark_answered: true }` but server Zod schema expects `{ action: 'mark_answered' }`. Fix client to send correct field.
- Bug #8 (New request not appearing): After creation, `refresh()` re-fetches current tab. If on "Others" tab, user's own prayer is excluded by query filter. Fix: auto-switch to "My Requests" tab after creation.
- Bug #7 (Video not loading): Partially depends on thumbnail generation (Plan 05). For now, ensure video elements have `preload="auto"` instead of `preload="metadata"` for better loading.

File references:
- PrayerCard.tsx: line 139-141 (mark_answered payload), line 382 (default icon)
- usePrayerWall.ts: refresh() and onSubmit callback
- PostReactionBar.tsx: highlight styling
- Server schema: src/app/api/prayer-requests/[id]/route.ts line 33 expects `action: z.enum(['mark_answered'])`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix prayer card default icon and mark-answered API mismatch</name>
  <files>src/components/prayer/PrayerCard.tsx</files>
  <action>
  **Fix 1 — Default reaction icon (Bug #9):**
  Find the default reaction display (around line 382) where the prayer hands emoji `&#x1F64F;` is rendered. Replace it with:
  ```tsx
  <Heart className="h-5 w-5" />
  ```
  Import `Heart` from `lucide-react` at the top of the file if not already imported. This makes the default reaction icon an outlined heart, consistent with the feed's reaction pattern.

  **Fix 2 — Mark answered API mismatch (Bug #10):**
  Find the `handleMarkAnswered` function (or wherever the PATCH request is made to mark a prayer as answered, around line 139-141). The current payload is:
  ```typescript
  body: JSON.stringify({
    mark_answered: true,
    testimony: testimonyInput.trim() || undefined,
  }),
  ```
  Change it to match the server's Zod schema:
  ```typescript
  body: JSON.stringify({
    action: 'mark_answered',
    testimony: testimonyInput.trim() || undefined,
  }),
  ```
  This ensures the server's `if (action === 'mark_answered')` check triggers correctly.

  **Fix 3 — Video preload (Bug #7 partial):**
  Find where `<video>` elements are rendered in PrayerCard (around line 351-356). Change `preload="metadata"` to `preload="auto"` so the browser actually loads video content. Also add `playsInline` attribute if not present. Full thumbnail fix comes in Plan 05.
  </action>
  <verify>
  Read the modified PrayerCard.tsx and confirm:
  1. Heart icon imported from lucide-react and used as default reaction
  2. Mark answered payload uses `action: 'mark_answered'` (not `mark_answered: true`)
  3. Video elements have `preload="auto"`
  </verify>
  <done>Default icon is outlined heart. Mark-answered sends correct API payload. Video elements preload content.</done>
</task>

<task type="auto">
  <name>Task 2: Improve reaction highlight and fix new prayer appearance</name>
  <files>src/components/social/PostReactionBar.tsx, src/hooks/usePrayerWall.ts</files>
  <action>
  **Fix 1 — Reaction highlight (Bug #6):**
  Open `src/components/social/PostReactionBar.tsx`. Find where the user's selected reaction is styled (look for `userReaction` state usage and `bg-primary/10` or similar subtle highlight).

  Make the user's selected reaction more visually prominent:
  1. Add a ring or border around the selected emoji: `ring-2 ring-primary` or `border-2 border-primary rounded-full`
  2. Scale up the selected emoji slightly: `scale-110` or `text-lg` vs `text-base` for others
  3. Increase background opacity: change `bg-primary/10` to `bg-primary/20` or `bg-primary/25`

  The goal is that when a user selects a reaction, their chosen emoji is clearly distinguishable from the others. Use a combination approach (e.g., scale + ring) for clear visual feedback.

  **Fix 2 — New prayer not appearing (Bug #8):**
  Open `src/hooks/usePrayerWall.ts`. Find the callback that fires after successful prayer creation (the `onSubmit` or `onSuccess` callback passed to PrayerComposer).

  After a successful creation:
  1. If the hook has a `setActiveTab` or similar function to change the active tab, call it to switch to "My Requests" (likely `'mine'` or `'my_requests'` tab value)
  2. Then call `refresh()` to fetch the updated list for the My Requests tab
  3. If there's no tab-switching mechanism, alternatively prepend the newly created prayer to the local state optimistically

  Check what tab values exist by searching for tab-related state in the hook. The pattern should be: create prayer -> switch to "mine" tab -> refresh.
  </action>
  <verify>
  Read the modified files and confirm:
  1. PostReactionBar has enhanced visual highlight for userReaction (ring, scale, or stronger background)
  2. usePrayerWall switches to My Requests tab after prayer creation and refreshes
  </verify>
  <done>Selected reaction is clearly highlighted on prayer cards. New prayer requests appear immediately in My Requests tab after creation.</done>
</task>

</tasks>

<verification>
1. PrayerCard shows outlined heart as default reaction icon
2. After selecting a reaction, the chosen emoji is visually prominent
3. Marking a prayer as answered works (sends `action: 'mark_answered'` to API)
4. New prayer requests auto-switch to My Requests tab and appear immediately
5. `npx next build` still passes
</verification>

<success_criteria>
- Prayer cards use heart outline default icon
- Reaction highlight is clearly visible to users
- Mark-answered flow works end-to-end (client sends correct field, server processes it, Answered tab shows it)
- New prayers appear in My Requests immediately after creation
</success_criteria>

<output>
After completion, create `.planning/phases/06-bug-fixes/06-03-SUMMARY.md`
</output>
