---
phase: 06-bug-fixes
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/prayer/PrayerComposer.tsx
autonomous: true

must_haves:
  truths:
    - "Prayer composer shows single 'Photo/Video' button instead of separate Camera and Gallery buttons"
    - "Prayer composer respects user's theme setting (light/dark) instead of always showing dark theme"
  artifacts:
    - path: "src/components/prayer/PrayerComposer.tsx"
      provides: "Simplified media picker and theme-aware prayer composer"
  key_links:
    - from: "src/components/prayer/PrayerComposer.tsx"
      to: "next-themes"
      via: "theme-aware CSS classes"
      pattern: "bg-surface|dark:"
---

<objective>
Simplify the prayer composer media picker to a single "Photo/Video" button and fix the composer to respect the user's theme setting instead of hardcoded dark theme.

Purpose: Improve prayer composer UX (simpler media picker) and fix visual inconsistency (theme not respected).
Output: Updated PrayerComposer with simplified media picker and theme-aware styling.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-bug-fixes/06-RESEARCH.md

Key research findings:
- Bug #11 (Simplify media picker): PrayerComposer has two buttons — "Camera" (line 473-482, opens cameraInputRef with `capture="environment"`) and "Gallery" (line 483-492, opens fileInputRef). Replace with single "Photo/Video" button that uses `accept="image/*,video/*"` without `capture` attribute, letting the OS show both camera and gallery options. Remove `cameraInputRef` and its hidden `<input>`.
- Bug #12 (Theme not respected): PrayerComposer uses hardcoded dark colors: `bg-gray-950/95`, `text-white`, `border-white/10`, etc. (line 332 onwards). Replace with theme-aware classes that respect `data-theme` attribute. Use `bg-surface/95 dark:bg-gray-950/95`, `text-text dark:text-white`, `border-border dark:border-white/10`, etc.

File reference: src/components/prayer/PrayerComposer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Simplify prayer composer media picker</name>
  <files>src/components/prayer/PrayerComposer.tsx</files>
  <action>
  **Step 1 — Replace two buttons with one:**
  Find the Camera button (around line 473-482) and Gallery button (around line 483-492). These are two separate `<button>` elements, each triggering a different hidden `<input type="file">`.

  Replace both buttons with a single "Photo/Video" button:
  ```tsx
  <button
    type="button"
    onClick={() => fileInputRef.current?.click()}
    disabled={media.length >= MAX_MEDIA}
    className="flex items-center gap-1.5 rounded-lg px-3 py-2 text-sm ..."
  >
    <ImageIcon className="h-4 w-4" />
    <span>Photo/Video</span>
  </button>
  ```

  Import `ImageIcon` (or `Image` aliased as `ImageIcon`) from lucide-react if not already present. If the component already imports a camera or gallery icon, replace with `ImageIcon` or use an existing appropriate icon.

  **Step 2 — Consolidate to single hidden input:**
  Find the two hidden `<input type="file">` elements — one with `ref={fileInputRef}` and one with `ref={cameraInputRef}` (with `capture="environment"`). Keep only the `fileInputRef` input and remove the camera one:
  ```tsx
  <input
    ref={fileInputRef}
    type="file"
    accept="image/jpeg,image/png,image/webp,image/gif,video/mp4"
    multiple
    className="hidden"
    onChange={(e) => { handleFilesSelected(e.target.files); e.target.value = ''; }}
  />
  ```
  Note: Do NOT include `capture` attribute — omitting it lets the OS show both camera and gallery options natively on mobile.

  **Step 3 — Remove cameraInputRef:**
  Find and remove the `cameraInputRef = useRef<HTMLInputElement>(null)` declaration. Remove any related state or handlers that were camera-input-specific.
  </action>
  <verify>Read the modified file. Confirm: only one "Photo/Video" button exists, only one hidden input (no capture attribute), cameraInputRef is removed.</verify>
  <done>Prayer composer has a single "Photo/Video" button that opens native OS media picker (camera + gallery combined).</done>
</task>

<task type="auto">
  <name>Task 2: Fix prayer composer theme to respect user setting</name>
  <files>src/components/prayer/PrayerComposer.tsx</files>
  <action>
  The PrayerComposer uses hardcoded dark-theme colors throughout. Systematically replace them with theme-aware Tailwind classes that work with the `data-theme` attribute system.

  **Key replacements:**

  1. Main container (around line 332):
     - `bg-gray-950/95` -> `bg-white/95 dark:bg-gray-950/95`
     - `text-white` -> `text-gray-900 dark:text-white`

  2. Input/textarea areas:
     - `bg-white/5` or `bg-white/10` -> `bg-gray-100 dark:bg-white/5`
     - `text-white` -> `text-gray-900 dark:text-white`
     - `placeholder-white/40` or `placeholder:text-white/40` -> `placeholder:text-gray-400 dark:placeholder:text-white/40`

  3. Borders:
     - `border-white/10` -> `border-gray-200 dark:border-white/10`
     - `divide-white/10` -> `divide-gray-200 dark:divide-white/10`

  4. Labels and secondary text:
     - `text-white/60` or `text-white/70` -> `text-gray-500 dark:text-white/60`
     - `text-white/80` -> `text-gray-600 dark:text-white/80`

  5. Buttons and interactive elements:
     - Check the close button, submit button, and any toggle buttons for hardcoded colors
     - The "Anonymous" toggle, media buttons, etc. should all be theme-aware

  6. Backdrop:
     - `backdrop-blur-xl` can stay — it works for both themes

  Go through the entire component systematically. Search for `white`, `gray-950`, `gray-900` and any color that assumes dark background. Replace each with a light-theme default + `dark:` variant.

  The project uses `data-theme` with `@custom-variant dark` in Tailwind v4, so `dark:` classes will work correctly.
  </action>
  <verify>Read the modified file. Search for any remaining hardcoded `text-white` (without `dark:` prefix) or `bg-gray-950` (without `dark:` prefix). All color classes should be theme-aware pairs.</verify>
  <done>Prayer composer renders with correct light theme when user has light theme selected, and dark theme when dark is selected. No hardcoded dark-only colors remain.</done>
</task>

</tasks>

<verification>
1. PrayerComposer has single "Photo/Video" button (no separate Camera/Gallery)
2. No `cameraInputRef` or `capture` attribute in the component
3. All color classes are theme-aware (light default + dark: variant)
4. `npx next build` still passes
</verification>

<success_criteria>
- Single "Photo/Video" button opens native picker with camera + gallery options
- Composer respects light/dark theme setting
- No visual regression in dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/06-bug-fixes/06-04-SUMMARY.md`
</output>
