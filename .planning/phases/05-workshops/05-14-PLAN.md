---
phase: 05-workshops
plan: 14
type: execute
wave: 6
depends_on: [05-07, 05-08, 05-11]
files_modified:
  - src/components/workshop/HostDashboard.tsx
  - src/app/(app)/workshops/dashboard/page.tsx
  - src/app/api/workshops/dashboard/route.ts
  - src/components/layout/BottomNav.tsx
  - src/components/layout/AppShell.tsx
  - src/app/api/admin/workshops/route.ts
autonomous: true

must_haves:
  truths:
    - "Host can view creator dashboard with upcoming workshops and analytics"
    - "Dashboard shows attendance trends, average watch time, and top workshops"
    - "Bottom nav includes Workshops tab for navigation"
    - "Admin can manage workshops (view all, revoke hosting privileges)"
    - "Admin can manage workshop categories"
  artifacts:
    - path: "src/components/workshop/HostDashboard.tsx"
      provides: "Analytics dashboard for workshop hosts"
    - path: "src/app/(app)/workshops/dashboard/page.tsx"
      provides: "Dashboard page"
    - path: "src/app/api/workshops/dashboard/route.ts"
      provides: "Dashboard analytics API"
      exports: ["GET"]
    - path: "src/components/layout/BottomNav.tsx"
      provides: "Updated bottom nav with Workshops tab"
    - path: "src/app/api/admin/workshops/route.ts"
      provides: "Admin workshop management API"
      exports: ["GET", "PUT"]
  key_links:
    - from: "src/components/workshop/HostDashboard.tsx"
      to: "/api/workshops/dashboard"
      via: "fetch GET analytics data"
      pattern: "api/workshops/dashboard"
    - from: "src/components/layout/BottomNav.tsx"
      to: "/workshops"
      via: "nav tab link"
      pattern: "/workshops"
---

<objective>
Create the host/creator dashboard with workshop analytics, add the Workshops tab to bottom navigation, and provide admin tools for workshop management and host privilege revocation.

Purpose: Hosts need analytics to understand their impact. Navigation needs to include workshops. Admins need oversight of the workshop system.
Output: Dashboard page + API, updated nav, admin API.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-workshops/05-CONTEXT.md
@src/components/layout/BottomNav.tsx
@src/components/layout/AppShell.tsx
@src/app/api/admin/moderation/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Host dashboard analytics API and UI</name>
  <files>src/app/api/workshops/dashboard/route.ts, src/app/(app)/workshops/dashboard/page.tsx, src/components/workshop/HostDashboard.tsx</files>
  <action>
    **Dashboard API (dashboard/route.ts) — GET (withAuth):**

    Return analytics for the authenticated user's hosted workshops.

    Response shape:
    ```json
    {
      "stats": {
        "totalWorkshops": 15,
        "totalAttendees": 342,
        "averageDuration": 67, // minutes
        "averageAttendance": 23,
        "totalRecordings": 12,
        "upcomingCount": 3
      },
      "upcomingWorkshops": [...], // next 5 scheduled workshops
      "recentWorkshops": [...], // last 10 ended workshops with attendance
      "attendanceTrend": [ // last 10 workshops: { date, count }
        { "date": "2026-02-14", "attendees": 25 },
        ...
      ],
      "topWorkshops": [...], // top 5 by attendee_count
      "series": [...] // active series with next instance
    }
    ```

    Queries:
    - totalWorkshops: COUNT WHERE host_id=user.id AND status='ended'
    - totalAttendees: SUM(attendee_count) WHERE host_id=user.id AND status='ended'
    - averageDuration: AVG(TIMESTAMPDIFF(MINUTE, actual_started_at, actual_ended_at))
    - attendanceTrend: last 10 workshops sorted by scheduled_at, with attendee_count
    - topWorkshops: ORDER BY attendee_count DESC LIMIT 5
    - upcomingWorkshops: WHERE status='scheduled' ORDER BY scheduled_at ASC LIMIT 5
    - recentWorkshops: WHERE status='ended' ORDER BY actual_ended_at DESC LIMIT 10
    - series: WHERE is_active=true with next scheduled instance

    Each workshop in lists includes: id, title, scheduled_at, actual_started_at, actual_ended_at, attendee_count, category name

    **HostDashboard.tsx:**
    Analytics dashboard component.

    Props: { data: DashboardData }

    Layout:
    - Stats grid (2x2 on mobile, 4-column on desktop):
      - Total Workshops (number with icon)
      - Total Attendees (number with icon)
      - Avg Duration (formatted minutes)
      - Avg Attendance (number)
    - Attendance Trend chart:
      - CSS bar chart (same pattern as moderation stats in Phase 4 — no chart library)
      - Bars representing attendee count per workshop
      - X-axis: workshop dates, Y-axis: attendee count
    - Upcoming Workshops section: compact list of next 5
    - Top Workshops section: list with attendee count ranking
    - Recent Workshops: expandable list with recording links

    **Dashboard page (dashboard/page.tsx):**
    'use client' page.
    - Fetch from /api/workshops/dashboard
    - Render HostDashboard component
    - Loading skeleton
    - If user hasn't hosted any workshops: "You haven't hosted any workshops yet" with link to create
  </action>
  <verify>TypeScript compiles. Dashboard API returns correct analytics. UI renders stats and trend chart.</verify>
  <done>Host dashboard provides full analytics: stats, trends, upcoming, top workshops, and series overview.</done>
</task>

<task type="auto">
  <name>Task 2: Bottom nav update and admin workshop management</name>
  <files>src/components/layout/BottomNav.tsx, src/components/layout/AppShell.tsx, src/app/api/admin/workshops/route.ts</files>
  <action>
    **BottomNav.tsx update:**
    Add Workshops tab to the bottom navigation.

    Current tabs: Daily, Prayer, Feed, (center +), Studies, Watch, Profile

    Add "Workshops" tab. Since we have 6 tabs + center button and adding a 7th would be too many, REPLACE the "Studies" tab (bible-studies is a placeholder page) with "Workshops":
    - Icon: lucide-react `Presentation` or `Video` (choose one that's distinct from Watch/Play)
    - Label: "Workshops"
    - Route: /workshops
    - Visible for both bible and positivity modes

    Update LEFT_TABS or RIGHT_TABS array to include workshops in place of bible-studies.

    If bible-studies is important, alternatively add Workshops as a 7th tab by making the tab bar scrollable, or combine. The cleanest approach is replacing the placeholder bible-studies tab.

    **AppShell.tsx update:**
    If the workshops route needs any special layout handling (like removing padding for specific workshop sub-routes), update AppShell's route checks. The /workshops/[id]/live route should already be handled by ImmersiveContext hiding the bottom nav.

    **Admin workshop management API (admin/workshops/route.ts):**

    **GET** (withAdmin):
    List all workshops with filters for admin oversight.
    - Support filters: status, host_id, category_id
    - Include host user info
    - Cursor pagination
    - Return: { workshops: [...], nextCursor }

    **PUT** (withAdmin):
    Admin actions on workshops:
    - Cancel any workshop (override host-only restriction)
    - Revoke hosting privileges: set User.can_host=false for a userId
    - Restore hosting privileges: set User.can_host=true

    Accept body: { action: 'cancel_workshop' | 'revoke_host' | 'restore_host', workshopId?: number, userId?: number }

    For cancel: update workshop status to 'cancelled', notify attendees
    For revoke_host: update user.can_host=false (lazy import User)
    For restore_host: update user.can_host=true

    Return: { success: true, action }
  </action>
  <verify>TypeScript compiles. BottomNav shows Workshops tab. Admin API supports cancel/revoke/restore actions.</verify>
  <done>Workshops tab in bottom nav, admin management API for oversight and host privilege control.</done>
</task>

</tasks>

<verification>
1. /workshops/dashboard shows analytics for host's workshops
2. Stats grid shows total workshops, attendees, avg duration, avg attendance
3. Attendance trend renders as CSS bar chart
4. Bottom nav includes Workshops tab
5. Admin can list all workshops
6. Admin can cancel any workshop
7. Admin can revoke/restore hosting privileges
</verification>

<success_criteria>
- Host dashboard provides actionable analytics
- Navigation includes Workshops for easy access
- Admin has full oversight of workshop system
- Host privilege revocation works at the user level
- Dashboard handles empty state for new hosts
</success_criteria>

<output>
After completion, create `.planning/phases/05-workshops/05-14-SUMMARY.md`
</output>
