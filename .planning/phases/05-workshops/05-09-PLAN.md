---
phase: 05-workshops
plan: 09
type: execute
wave: 4
depends_on: [05-03, 05-04]
files_modified:
  - src/app/(app)/workshops/create/page.tsx
  - src/components/workshop/CreateWorkshopForm.tsx
  - src/app/(app)/workshops/[id]/edit/page.tsx
autonomous: true

must_haves:
  truths:
    - "Host can create a workshop with title, description, schedule, category, and privacy setting"
    - "Host can create a recurring series with frequency selection"
    - "Host can edit an existing scheduled workshop"
    - "Form validates 15-minute minimum lead time"
  artifacts:
    - path: "src/app/(app)/workshops/create/page.tsx"
      provides: "Create workshop page"
    - path: "src/components/workshop/CreateWorkshopForm.tsx"
      provides: "Workshop creation/edit form component"
    - path: "src/app/(app)/workshops/[id]/edit/page.tsx"
      provides: "Edit workshop page"
  key_links:
    - from: "src/components/workshop/CreateWorkshopForm.tsx"
      to: "/api/workshops"
      via: "fetch POST"
      pattern: "fetch.*api/workshops"
    - from: "src/components/workshop/CreateWorkshopForm.tsx"
      to: "/api/workshops/series"
      via: "fetch POST for recurring"
      pattern: "api/workshops/series"
---

<objective>
Create the workshop creation and edit forms with recurring series support. Hosts can schedule one-time or recurring workshops with all required details.

Purpose: Hosts need an intuitive form to schedule workshops, including recurring series with RRULE-based patterns.
Output: Create page, edit page, and shared form component.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-workshops/05-CONTEXT.md
@src/components/feed/PostComposer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: CreateWorkshopForm component</name>
  <files>src/components/workshop/CreateWorkshopForm.tsx</files>
  <action>
    Create a comprehensive form component used by both create and edit pages.

    Props: {
      mode: 'create' | 'edit',
      initialData?: Partial<WorkshopFormData>,
      workshopId?: number, // for edit mode
      onSuccess?: (workshop: Workshop) => void,
    }

    Form fields (use react-hook-form + Zod validation):
    - **Title** (Input, required, 3-200 chars)
    - **Description** (textarea, optional, max 5000 chars)
    - **Category** (select dropdown, fetched from /api/workshops/categories, optional)
    - **Date & Time** (date input + time input, required)
      - Date picker: native date input (type="date")
      - Time picker: native time input (type="time")
      - Validate combined datetime is >= 15 min from now
      - Show error message: "Workshop must be scheduled at least 15 minutes from now"
    - **Duration** (number input, optional, 15-480 minutes, placeholder "Estimated duration")
    - **Privacy** (toggle switch: "Private (invite-only)" — default off)
    - **Max capacity** (number input, optional, shown only when toggled, 2-500)

    **Recurring Series section** (collapsible, create mode only):
    - Toggle: "Make this a recurring series"
    - When expanded:
      - Frequency: select (Daily, Weekly, Biweekly, Monthly)
      - Days of week: checkbox group for Mon-Sun (shown for Weekly/Biweekly)
      - End condition: radio (Never / After N occurrences / Until date)
        - "After N": number input (1-52)
        - "Until date": date input
    - **Timezone** (auto-detected from browser Intl.DateTimeFormat().resolvedOptions().timeZone, displayed as text, not editable — stored with series)

    Submission:
    - If recurring: POST to /api/workshops/series with frequency, byDay, count/until, time_of_day, timezone
    - If one-time: POST to /api/workshops with form data
    - If edit: PUT to /api/workshops/[id]
    - Show loading state on submit button
    - On success: toast success, navigate to workshop detail or browse page
    - On error: show error message

    Styling:
    - Use Input, Button, Card components from src/components/ui
    - Clean mobile-first form layout with proper spacing
    - Dark mode support
  </action>
  <verify>TypeScript compiles. Form has all fields. Validation enforces constraints.</verify>
  <done>Workshop creation/edit form handles both one-time and recurring workshops with full validation.</done>
</task>

<task type="auto">
  <name>Task 2: Create and edit workshop pages</name>
  <files>src/app/(app)/workshops/create/page.tsx, src/app/(app)/workshops/[id]/edit/page.tsx</files>
  <action>
    **create/page.tsx:**
    'use client' page.

    Layout:
    - TopBar-style header with back arrow and "Create Workshop" title
    - CreateWorkshopForm component in create mode
    - Check user can_host before rendering (fetch from /api/auth/me or useAuth)
    - If !can_host, show message "Your hosting privileges have been revoked. Contact support."
    - On success: navigate to /workshops/[newId]

    **edit/page.tsx:**
    'use client' page.

    Layout:
    - TopBar-style header with back arrow and "Edit Workshop" title
    - Fetch existing workshop data from /api/workshops/[id]
    - Only accessible by host (check workshop.host_id === user.id)
    - Only accessible for 'scheduled' workshops (can't edit live/ended/cancelled)
    - CreateWorkshopForm component in edit mode with initialData
    - On success: navigate back to /workshops/[id]
    - If not host or not scheduled: show 404 or redirect

    Both pages:
    - Loading state with skeleton
    - Error handling for API failures
  </action>
  <verify>TypeScript compiles. Create page accessible to can_host users. Edit page fetches and prefills form. Recurring section only in create mode.</verify>
  <done>Create and edit workshop pages functional with proper access control and form validation.</done>
</task>

</tasks>

<verification>
1. /workshops/create shows form with all fields
2. Recurring series toggle expands series options
3. 15-minute minimum lead time validated
4. Form submits to correct API endpoint (create vs series vs edit)
5. Edit page prefills existing data
6. Edit restricted to host + scheduled status
7. can_host check prevents revoked users from creating
</verification>

<success_criteria>
- Workshop creation form covers all required fields
- Recurring series creation generates instances via series API
- Edit form properly loads and saves changes
- Access control enforced (can_host, host-only edit)
- Mobile-first responsive form layout
</success_criteria>

<output>
After completion, create `.planning/phases/05-workshops/05-09-SUMMARY.md`
</output>
