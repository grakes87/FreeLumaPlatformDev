---
phase: 05-workshops
plan: 12
type: execute
wave: 5
depends_on: [05-05, 05-06, 05-10]
files_modified:
  - src/components/workshop/WorkshopChat.tsx
  - src/components/workshop/WorkshopParticipants.tsx
  - src/components/workshop/WorkshopControls.tsx
  - src/components/workshop/WorkshopNotes.tsx
autonomous: true

must_haves:
  truths:
    - "Users can send and receive real-time chat messages in the workshop room"
    - "Workshop room displays live attendee list with presence indicators"
    - "Attendees can raise hand to request speaking permission"
    - "Host can manage attendees from the participants panel (mute, remove, promote)"
    - "Users can take personal notes during the workshop"
  artifacts:
    - path: "src/components/workshop/WorkshopChat.tsx"
      provides: "In-room chat sidebar"
    - path: "src/components/workshop/WorkshopParticipants.tsx"
      provides: "Attendee list with raise hand"
    - path: "src/components/workshop/WorkshopControls.tsx"
      provides: "Host controls panel"
    - path: "src/components/workshop/WorkshopNotes.tsx"
      provides: "Personal notes panel"
  key_links:
    - from: "src/components/workshop/WorkshopChat.tsx"
      to: "src/hooks/useWorkshopChat.ts"
      via: "useWorkshopChat hook"
      pattern: "useWorkshopChat"
    - from: "src/components/workshop/WorkshopParticipants.tsx"
      to: "src/hooks/useWorkshopSocket.ts"
      via: "useWorkshopSocket hook for attendees"
      pattern: "useWorkshopSocket"
---

<objective>
Create the workshop room sidebar components: real-time chat, participant list with raise hand, host controls, and personal notes. These form the interactive sidebar alongside the video area.

Purpose: These components provide the interaction layer around the video feed — chat for Q&A, participants for presence, controls for host moderation, notes for personal reference.
Output: 4 sidebar components for the live workshop room.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-workshops/05-CONTEXT.md
@src/components/chat/MessageBubble.tsx
@src/hooks/useWorkshopSocket.ts
@src/hooks/useWorkshopChat.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Workshop chat and notes components</name>
  <files>src/components/workshop/WorkshopChat.tsx, src/components/workshop/WorkshopNotes.tsx</files>
  <action>
    **WorkshopChat.tsx:**
    In-room real-time chat component.

    Props: {
      messages: ChatMessage[],
      onSendMessage: (text: string) => void,
    }

    Layout:
    - Messages list (scrollable, auto-scroll to bottom on new message)
    - Each message: avatar (small), username, message text, timestamp
    - Compact style (similar to Twitch/YouTube live chat, not full DM bubbles)
    - Different styling for host messages (highlighted background or host badge)
    - Input at bottom: text input + send button
    - Max 1000 chars per message

    Styling:
    - Dark background to match workshop room aesthetic
    - Compact line spacing for high message volume
    - Auto-scroll with "scroll to latest" button when user scrolls up
    - cn() for conditional classes

    **WorkshopNotes.tsx:**
    Personal notes panel for in-workshop note-taking.

    Props: {
      workshopId: number,
    }

    Implementation:
    - Fetch existing notes from GET /api/workshops/[id]/notes on mount
    - Large textarea for note content (fills available height)
    - Debounced auto-save (2s debounce) to PUT /api/workshops/[id]/notes
    - Follow the exact pattern from the existing Draft auto-save (useDraft hook pattern)
    - Show "Saved" indicator after successful save
    - Show "Saving..." during save
    - Max 50000 chars

    Styling:
    - Dark background matching room
    - Monospace or clean sans-serif font for notes
    - Full height textarea
  </action>
  <verify>TypeScript compiles. Chat scrolls and sends messages. Notes auto-save with debounce.</verify>
  <done>In-room chat and personal notes components functional with real-time messaging and auto-save.</done>
</task>

<task type="auto">
  <name>Task 2: Participants panel and host controls</name>
  <files>src/components/workshop/WorkshopParticipants.tsx, src/components/workshop/WorkshopControls.tsx</files>
  <action>
    **WorkshopParticipants.tsx:**
    Live attendee list with raise hand functionality.

    Props: {
      attendees: AttendeeInfo[],
      raisedHands: number[], // userIds with hand raised
      isHost: boolean,
      isCoHost: boolean,
      currentUserId: number,
      onRaiseHand: () => void,
      onLowerHand: () => void,
      onApproveSpeaker: (userId: number) => void,
      onRevokeSpeaker: (userId: number) => void,
      onPromoteCoHost: (userId: number) => void,
      onDemoteCoHost: (userId: number) => void,
      onMuteUser: (userId: number) => void,
      onRemoveUser: (userId: number) => void,
    }

    Layout:
    - Section header: "Participants ([count])"
    - "Raise Hand" button for attendees (toggles hand icon)
    - Attendee list grouped:
      1. Host (crown icon, always first)
      2. Co-hosts (star icon)
      3. Speaking (microphone icon, hand approved)
      4. Raised hands (hand icon, pulsing — shown to host/co-host)
      5. Audience (regular)
    - Each item: avatar, display_name, role badge, action menu (for host/co-host)

    For host/co-host, each attendee has context menu (3-dot or long press):
    - "Approve to Speak" / "Revoke Speaking" (if hand raised)
    - "Promote to Co-Host" / "Demote" (host only, not co-host)
    - "Mute" (sends mute signal via socket)
    - "Remove from Workshop" (with confirmation)

    For attendees:
    - "Raise Hand" button at top (toggle)
    - Can see who else is in the room
    - Cannot see host controls

    **WorkshopControls.tsx:**
    Host-only controls bar rendered in the workshop room.

    Props: {
      workshopId: number,
      isHost: boolean,
      isScreenSharing: boolean,
      onEndWorkshop: () => void,
      onToggleScreenShare: () => void,
    }

    Layout (bottom bar or floating controls):
    - End Workshop button (red, prominent — with confirmation dialog)
    - Screen Share toggle button
    - Duration timer (time elapsed since actual_started_at)
    - Attendee count badge

    Only rendered for host/co-host. Attendees see a simpler bar with just the leave button and raise hand.
  </action>
  <verify>TypeScript compiles. Participants list groups by role. Host sees management options. Raise hand toggles.</verify>
  <done>Participants panel shows grouped attendees with raise hand. Host controls provide workshop management actions.</done>
</task>

</tasks>

<verification>
1. Chat messages appear in real-time with auto-scroll
2. Notes auto-save with debounce indicator
3. Participants list groups: host, co-hosts, speakers, raised hands, audience
4. Raise hand button toggles for attendees
5. Host sees approve/revoke/promote/mute/remove actions per attendee
6. End Workshop button shows confirmation dialog
7. Duration timer counts up from workshop start
</verification>

<success_criteria>
- Real-time chat enables Q&A during live workshops
- Personal notes persist with auto-save
- Participant list provides clear role hierarchy
- Raise hand mechanism connects attendees to host for speaking approval
- Host controls cover all management actions
- Dark-themed UI matches live workshop aesthetic
</success_criteria>

<output>
After completion, create `.planning/phases/05-workshops/05-12-SUMMARY.md`
</output>
