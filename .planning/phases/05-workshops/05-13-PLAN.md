---
phase: 05-workshops
plan: 13
type: execute
wave: 6
depends_on: [05-06, 05-11, 05-12]
files_modified:
  - src/components/workshop/WorkshopSummary.tsx
  - src/components/workshop/ChatReplay.tsx
  - src/app/(app)/workshops/series/[seriesId]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Attendees see a summary screen after workshop ends with duration, attendance, and recording link"
    - "Recording playback shows time-synced chat replay sidebar"
    - "Series overview page shows upcoming and past instances"
  artifacts:
    - path: "src/components/workshop/WorkshopSummary.tsx"
      provides: "Post-workshop summary screen"
    - path: "src/components/workshop/ChatReplay.tsx"
      provides: "Time-synced chat sidebar for recordings"
    - path: "src/app/(app)/workshops/series/[seriesId]/page.tsx"
      provides: "Series overview page"
  key_links:
    - from: "src/components/workshop/ChatReplay.tsx"
      to: "/api/workshops/[id]/chat"
      via: "fetch GET chat history"
      pattern: "api/workshops.*chat"
    - from: "src/components/workshop/WorkshopSummary.tsx"
      to: "src/components/workshop/WorkshopDetail.tsx"
      via: "reuses detail layout"
      pattern: "WorkshopDetail"
---

<objective>
Create the post-workshop summary screen, chat replay component for recordings, and the series overview page. These complete the workshop lifecycle from live event to post-event content.

Purpose: After a workshop ends, attendees need a summary. Recordings need time-synced chat for full replay experience. Series need an overview page to see upcoming and past sessions.
Output: Summary screen, chat replay component, series page.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-workshops/05-CONTEXT.md
@.planning/phases/05-workshops/05-RESEARCH.md
@src/components/video/VideoPlayer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Workshop summary and chat replay</name>
  <files>src/components/workshop/WorkshopSummary.tsx, src/components/workshop/ChatReplay.tsx</files>
  <action>
    **WorkshopSummary.tsx:**
    Post-workshop summary screen shown when workshop transitions to 'ended'.

    Props: {
      workshop: WorkshopData,
      attendeeCount: number,
    }

    Layout:
    - "Workshop Ended" header with checkmark icon
    - Workshop title
    - Duration: calculated from actual_started_at to actual_ended_at (formatted as "1h 23m")
    - Attendee count: "[N] people attended"
    - Recording status:
      - If recording_url available: "Recording Available" with play icon button -> links to video in library
      - If not yet available: "Recording processing..." with spinner
    - If series: "Next Session: [date]" with link to next instance
    - "Back to Workshops" button -> /workshops
    - "View Recording" button (if available) -> /watch/[videoId]

    Styling:
    - Centered content on dark background
    - Card-style summary box
    - Clean, celebratory UI (soft colors, completion feel)

    **ChatReplay.tsx:**
    Time-synced chat sidebar for workshop recording playback.

    Props: {
      workshopId: number,
      currentTimeMs: number, // Current video playback position in milliseconds
    }

    Implementation:
    - Fetch all chat messages from GET /api/workshops/[workshopId]/chat on mount
    - Filter visible messages: show messages WHERE offset_ms <= currentTimeMs
    - Use useMemo to efficiently filter based on currentTimeMs changes
    - Auto-scroll to latest visible message when new messages appear
    - Show "scroll to latest" button when user scrolls up

    Each message renders:
    - Timestamp formatted as duration from start (e.g., "12:34")
    - Username (compact)
    - Message text

    Layout:
    - Sidebar panel (right side on desktop, collapsible bottom sheet on mobile)
    - Header: "Chat Replay" with message count
    - Scrollable message list
    - No input field (replay is read-only)

    Integration note: This component is designed to sit alongside the video player on the watch/[id] detail page for workshop recordings. The currentTimeMs comes from the video player's time update callback. The actual integration with the video player page will be handled in the integration plan.
  </action>
  <verify>TypeScript compiles. Summary shows duration and recording status. Chat replay filters by playback position.</verify>
  <done>Post-workshop summary and time-synced chat replay functional for the complete workshop lifecycle.</done>
</task>

<task type="auto">
  <name>Task 2: Workshop series overview page</name>
  <files>src/app/(app)/workshops/series/[seriesId]/page.tsx</files>
  <action>
    'use client' page.

    Fetch series data from /api/workshops/series (with seriesId filter) and workshops for this series.

    Layout:
    - Series title (large)
    - Host info: avatar + name
    - Category badge
    - Recurrence description: "Every week on Monday" (from rrule.toText())
    - Time: "7:00 PM EST" (time_of_day + timezone)
    - Duration estimate
    - Description

    - **Upcoming Sessions** section:
      - List of WorkshopCards for upcoming instances (status='scheduled')
      - Each links to /workshops/[id]

    - **Past Sessions** section:
      - List of WorkshopCards for past instances (status='ended')
      - Show recording link if available
      - Collapsed by default, expandable

    - If user is host: "Edit Series" and "Cancel Series" buttons
      - Cancel Series: sets WorkshopSeries.is_active=false and cancels all future scheduled instances

    Data fetching:
    - GET /api/workshops?series_id=[seriesId] to get all instances
    - Split into upcoming (scheduled) and past (ended)
    - Sort upcoming by scheduled_at ASC, past by scheduled_at DESC
  </action>
  <verify>TypeScript compiles. Series page shows upcoming and past sessions. Recurrence description displayed.</verify>
  <done>Series overview shows all instances with upcoming/past split and recurrence description.</done>
</task>

</tasks>

<verification>
1. WorkshopSummary shows duration, attendee count, recording status
2. ChatReplay filters messages by playback position
3. Chat replay auto-scrolls to latest visible message
4. Series page lists upcoming and past instances
5. Series page shows recurrence description from RRULE
6. Host sees edit/cancel actions on series page
</verification>

<success_criteria>
- Post-workshop experience is complete with summary and recording access
- Chat replay provides time-synced context alongside recordings
- Series overview gives hosts and attendees full visibility into recurring workshops
- All post-workshop content (recordings, chat) is preserved and accessible
</success_criteria>

<output>
After completion, create `.planning/phases/05-workshops/05-13-SUMMARY.md`
</output>
