---
phase: 14-first-time-user-tutorial-walkthrough
plan: 03
type: execute
wave: 3
depends_on: ["14-02"]
files_modified:
  - src/components/daily/DailyPostSlide.tsx
  - src/components/daily/VerseModeToggle.tsx
  - src/components/layout/BottomNav.tsx
  - src/components/daily/ReactionBar.tsx
  - src/app/(app)/layout.tsx
  - src/app/(app)/settings/page.tsx
autonomous: true

must_haves:
  truths:
    - "data-tutorial attributes present on daily card, verse toggle, bottom nav, and reactions area"
    - "TutorialProvider wraps AppShell inside authenticated layout"
    - "Tutorial triggers automatically for users with has_seen_tutorial=false"
    - "Tutorial does NOT trigger for guest/unauthenticated users"
    - "Replay Tutorial button exists in Settings page"
    - "Clicking Replay resets has_seen_tutorial and navigates to daily feed"
    - "Build compiles successfully with zero TypeScript errors"
  artifacts:
    - path: "src/app/(app)/layout.tsx"
      provides: "TutorialProvider integration point"
      contains: "TutorialProvider"
    - path: "src/app/(app)/settings/page.tsx"
      provides: "Replay Tutorial button"
      contains: "Replay Tutorial"
  key_links:
    - from: "src/app/(app)/layout.tsx"
      to: "src/components/tutorial/TutorialProvider.tsx"
      via: "import and wrapper around AppShell"
      pattern: "TutorialProvider"
    - from: "src/components/daily/DailyPostSlide.tsx"
      to: "src/components/tutorial/TutorialCoachMarks.tsx"
      via: "data-tutorial attribute on root element"
      pattern: "data-tutorial"
    - from: "src/app/(app)/settings/page.tsx"
      to: "/api/tutorial"
      via: "PUT with reset:true on Replay button click"
      pattern: "api/tutorial.*reset"
---

<objective>
Wire the tutorial system into the app -- add data-tutorial attributes to target UI elements, integrate TutorialProvider into the authenticated layout, and add Replay Tutorial to Settings.

Purpose: Without this integration, the tutorial components exist but are never rendered or triggered. This plan connects everything together and makes the tutorial functional end-to-end.
Output: Modified layout with TutorialProvider wrapper, data-tutorial attributes on 4 target components, Replay button in Settings, and verified build.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-first-time-user-tutorial-walkthrough/14-CONTEXT.md
@.planning/phases/14-first-time-user-tutorial-walkthrough/14-RESEARCH.md
@.planning/phases/14-first-time-user-tutorial-walkthrough/14-01-SUMMARY.md
@.planning/phases/14-first-time-user-tutorial-walkthrough/14-02-SUMMARY.md

@src/app/(app)/layout.tsx
@src/app/(app)/settings/page.tsx
@src/components/daily/DailyPostSlide.tsx
@src/components/daily/VerseModeToggle.tsx
@src/components/layout/BottomNav.tsx
@src/components/daily/ReactionBar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add data-tutorial attributes and wire TutorialProvider into layout</name>
  <files>
    src/components/daily/DailyPostSlide.tsx
    src/components/daily/VerseModeToggle.tsx
    src/components/layout/BottomNav.tsx
    src/components/daily/ReactionBar.tsx
    src/app/(app)/layout.tsx
  </files>
  <action>
    1. **DailyPostSlide.tsx**: Add `data-tutorial="daily-card"` attribute to the outermost wrapper div of the daily post slide component. Find the root element that wraps the entire slide content and add the attribute there.

    2. **VerseModeToggle.tsx**: Add `data-tutorial="verse-toggle"` attribute to the outermost wrapper div of the verse mode toggle component.

    3. **BottomNav.tsx**: Add `data-tutorial="bottom-nav"` attribute to the outermost `<nav>` or wrapper element of the bottom navigation bar.

    4. **ReactionBar.tsx**: Add `data-tutorial="reactions-area"` attribute to the outermost wrapper div of the reaction bar component (the one containing the heart/comment icons on the daily post).

    5. **layout.tsx** (`src/app/(app)/layout.tsx`): In the AuthenticatedLayout component, wrap the content inside the authenticated return (where SocketProvider/NotificationProvider/FontLoader/AppShell are) with TutorialProvider:

       ```typescript
       import { TutorialProvider } from '@/components/tutorial/TutorialProvider';
       ```

       Update the authenticated return block from:
       ```tsx
       <SocketProvider>
         <NotificationProvider>
           <FontLoader />
           <AppShell>{children}</AppShell>
         </NotificationProvider>
       </SocketProvider>
       ```
       To:
       ```tsx
       <SocketProvider>
         <NotificationProvider>
           <FontLoader />
           <TutorialProvider>
             <AppShell>{children}</AppShell>
           </TutorialProvider>
         </NotificationProvider>
       </SocketProvider>
       ```

       TutorialProvider must be INSIDE NotificationProvider (needs auth context which is already above) and wrapping AppShell (so tutorial overlays render above the app content). TutorialProvider reads from useAuth() which is available because AuthProvider wraps the entire layout.

    **Important:** Only add the data-tutorial attribute -- do NOT change any other behavior, styling, or structure of these components. The attribute is inert and has zero impact on existing functionality.
  </action>
  <verify>
    - `grep -r "data-tutorial" src/components/ src/app/` shows 4 data-tutorial attributes across 4 files
    - `grep "TutorialProvider" src/app/\(app\)/layout.tsx` shows the import and usage
    - TypeScript compiles: `npx tsc --noEmit --pretty 2>&1 | head -20`
  </verify>
  <done>data-tutorial attributes on DailyPostSlide (daily-card), VerseModeToggle (verse-toggle), BottomNav (bottom-nav), ReactionBar (reactions-area); TutorialProvider wraps AppShell in authenticated layout</done>
</task>

<task type="auto">
  <name>Task 2: Settings Replay button and build verification</name>
  <files>
    src/app/(app)/settings/page.tsx
  </files>
  <action>
    1. **Settings page** (`src/app/(app)/settings/page.tsx`): Add a "Replay Tutorial" option in the settings page. Place it in a logical position -- after the notification preferences section or before the Danger Zone section.

       Implementation:
       - Add a `RefreshCw` icon import from lucide-react (or `RotateCcw`)
       - Create a new section/card with a button labeled "Replay Tutorial"
       - Subtitle text: "Watch the app introduction again"
       - On click:
         a. Call `PUT /api/tutorial` with `{ reset: true }` body
         b. Show a toast: "Tutorial will start on the home screen"
         c. Navigate to '/' (the daily feed route) using router.push('/')
       - Use the same card/row styling as other settings sections
       - The button should be styled consistently with other settings actions (not a danger action)

    2. **Build verification**: Run `npx next build` to verify the entire app compiles successfully with all tutorial changes. If there are TypeScript errors, fix them. Focus on:
       - Import paths for tutorial components
       - UserData type compatibility
       - Any missing or extra props

    **Important:** Do NOT use `useTutorial()` hook in settings -- the replay action is a simple API call + navigation. The TutorialProvider on the daily feed page will detect `has_seen_tutorial: false` and automatically trigger.
  </action>
  <verify>
    - `npx next build` completes successfully
    - Settings page renders with "Replay Tutorial" button visible
    - Clicking Replay calls PUT /api/tutorial with reset:true
    - After clicking Replay, user is navigated to / where tutorial auto-triggers
  </verify>
  <done>"Replay Tutorial" button in Settings page calls reset API and navigates to home; build compiles with zero errors; entire tutorial system functional end-to-end</done>
</task>

</tasks>

<verification>
- `npx next build` succeeds with zero errors
- 4 data-tutorial attributes present across target components
- TutorialProvider wraps AppShell in authenticated layout
- Settings page has Replay Tutorial button
- Full tutorial flow works: new user sees slideshow -> coach marks -> marks complete
- Replay from settings resets and re-triggers tutorial
- Guest users do NOT see the tutorial
- Tutorial does not re-appear after completion on subsequent visits
</verification>

<success_criteria>
- data-tutorial attributes on DailyPostSlide, VerseModeToggle, BottomNav, ReactionBar
- TutorialProvider integrated in authenticated layout (inside NotificationProvider, wrapping AppShell)
- Replay Tutorial in Settings calls reset API and navigates to daily feed
- Build compiles successfully
- End-to-end tutorial flow functional for first-time users
</success_criteria>

<output>
After completion, create `.planning/phases/14-first-time-user-tutorial-walkthrough/14-03-SUMMARY.md`
</output>
