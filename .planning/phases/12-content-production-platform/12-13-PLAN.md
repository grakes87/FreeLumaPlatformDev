---
phase: 12-content-production-platform
plan: 13
type: execute
wave: 5
depends_on: ["12-04", "12-06"]
files_modified:
  - src/lib/email/templates/creator-assignment.ts
  - src/lib/email/templates/creator-rejection.ts
  - src/lib/content-pipeline/notifications.ts
autonomous: true

must_haves:
  truths:
    - "Creator receives email when new scripts are assigned"
    - "Creator receives email with rejection note when admin rejects video"
    - "Emails use existing SendGrid pattern with unsubscribe headers"
  artifacts:
    - path: "src/lib/email/templates/creator-assignment.ts"
      provides: "Assignment notification email template"
      exports: ["sendCreatorAssignmentEmail"]
    - path: "src/lib/email/templates/creator-rejection.ts"
      provides: "Rejection notification email template"
      exports: ["sendCreatorRejectionEmail"]
    - path: "src/lib/content-pipeline/notifications.ts"
      provides: "Pipeline notification dispatch functions"
      exports: ["notifyCreatorAssignment", "notifyCreatorRejection"]
  key_links:
    - from: "src/lib/content-pipeline/notifications.ts"
      to: "src/lib/email/templates/creator-assignment.ts"
      via: "sends assignment email"
      pattern: "sendCreatorAssignmentEmail"
    - from: "src/lib/content-pipeline/notifications.ts"
      to: "src/lib/email/templates/creator-rejection.ts"
      via: "sends rejection email"
      pattern: "sendCreatorRejectionEmail"
---

<objective>
Create creator email notifications for assignment and rejection events, following existing SendGrid email patterns.

Purpose: Creators need to know when new scripts are assigned (so they can start recording) and when their video is rejected (so they can re-record with admin feedback).
Output: 2 email templates and a notification dispatch module.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-content-production-platform/12-CONTEXT.md
@src/lib/email/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create creator email templates and notification dispatcher</name>
  <files>
    src/lib/email/templates/creator-assignment.ts
    src/lib/email/templates/creator-rejection.ts
    src/lib/content-pipeline/notifications.ts
  </files>
  <action>
**creator-assignment.ts** -- Assignment notification email:
Follow the existing SendGrid email template pattern from src/lib/email/.

Export `sendCreatorAssignmentEmail(params: { creatorEmail: string; creatorName: string; assignmentCount: number; month: string; mode: 'bible' | 'positivity' }): Promise<void>`

Email content:
- Subject: "New Scripts Assigned - {Month} {Year}"
- Body: Friendly message informing creator that X scripts have been assigned for {Month}. Include mode (Bible/Positivity). Link to creator portal: `https://freeluma.com/creator`. Mention due date (15th of the month).
- Use existing email HTML template structure (header, body, CTA button, footer with unsubscribe)
- Include RFC 8058 List-Unsubscribe headers (matching established pattern)

**creator-rejection.ts** -- Rejection notification email:
Export `sendCreatorRejectionEmail(params: { creatorEmail: string; creatorName: string; date: string; rejectionNote: string; mode: 'bible' | 'positivity' }): Promise<void>`

Email content:
- Subject: "Video Needs Re-Recording - {date}"
- Body: Friendly message that admin has requested a re-recording for {date}'s {mode} content. Include the admin's rejection note prominently. Link to creator portal for re-recording: `https://freeluma.com/creator`.
- Use same HTML template structure

**notifications.ts** -- Dispatch functions:
Export `notifyCreatorAssignment(creatorId: number, month: string, mode: 'bible' | 'positivity', assignmentCount: number): Promise<void>`:
1. Lazy-import LumaShortCreator and User models
2. Find creator by id with user include (to get email)
3. If user has email, send assignment email (fire-and-forget, wrapped in try/catch)
4. Also create in-app notification via createNotification if desired (optional -- email is primary per CONTEXT)

Export `notifyCreatorRejection(dailyContentId: number): Promise<void>`:
1. Lazy-import DailyContent with creator include
2. Get content with creator and user
3. If creator's user has email, send rejection email with the rejection_note
4. Fire-and-forget, wrapped in try/catch

Both functions are designed to be called fire-and-forget from the assignment and review API routes. They should never throw (all errors caught and logged).

Wire into existing code:
- In assignment.ts autoAssignMonth: after successful assignment, call notifyCreatorAssignment (grouped -- one email per creator per auto-assign run, not per day)
- In review/route.ts reject action: call notifyCreatorRejection after status update
  </action>
  <verify>Run `npx tsc --noEmit src/lib/email/templates/creator-assignment.ts src/lib/email/templates/creator-rejection.ts src/lib/content-pipeline/notifications.ts` for TypeScript check.</verify>
  <done>Creator receives email on assignment (with count and due date) and on rejection (with admin feedback note). Notifications are fire-and-forget, non-blocking.</done>
</task>

</tasks>

<verification>
- Email templates compile and follow existing SendGrid pattern
- Notification functions are non-throwing (all errors caught)
- Assignment email sent once per creator per auto-assign run (not per day)
- Rejection email includes the admin's rejection note text
</verification>

<success_criteria>
- Assignment email sent when scripts are assigned via auto-assign
- Rejection email sent when admin rejects a video with feedback note
- Emails link to creator portal at freeluma.com/creator
- Both use existing SendGrid transport with unsubscribe headers
- Non-blocking, fire-and-forget pattern
</success_criteria>

<output>
After completion, create `.planning/phases/12-content-production-platform/12-13-SUMMARY.md`
</output>
