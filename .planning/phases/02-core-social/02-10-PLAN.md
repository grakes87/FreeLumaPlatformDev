---
phase: 02-core-social
plan: 10
type: execute
wave: 4
depends_on: [02-04, 02-05, 02-06, 02-08, 02-09]
files_modified:
  - src/app/(app)/feed/page.tsx
  - src/components/feed/PostCard.tsx
  - src/components/feed/PostComposer.tsx
  - src/components/feed/BibleVerseCard.tsx
  - src/components/feed/FeedFilters.tsx
  - src/components/feed/PostFeed.tsx
  - src/components/feed/EmptyFeedState.tsx
autonomous: false

must_haves:
  truths:
    - "User can view feed page with infinite-scrolling posts"
    - "User can create a new text post from the feed page"
    - "User can create a Bible verse post with translation selection"
    - "User can filter feed by category and sort by newest/engaged"
    - "Each post card shows author, content, reactions, comments, bookmark, share"
    - "Empty feed shows follow suggestions"
  artifacts:
    - path: "src/app/(app)/feed/page.tsx"
      provides: "Feed page replacing placeholder"
      min_lines: 30
    - path: "src/components/feed/PostCard.tsx"
      provides: "Post display card with action buttons"
      min_lines: 50
    - path: "src/components/feed/PostComposer.tsx"
      provides: "Create/edit post modal"
      min_lines: 50
    - path: "src/components/feed/PostFeed.tsx"
      provides: "Feed list with infinite scroll"
      min_lines: 30
  key_links:
    - from: "src/app/(app)/feed/page.tsx"
      to: "src/components/feed/PostFeed.tsx"
      via: "component composition"
      pattern: "PostFeed"
    - from: "src/components/feed/PostFeed.tsx"
      to: "src/hooks/useFeed.ts"
      via: "hook consumption"
      pattern: "useFeed"
    - from: "src/components/feed/PostCard.tsx"
      to: "src/components/social/LikeButton.tsx"
      via: "component composition"
      pattern: "LikeButton"
---

<objective>
Build the main feed page UI: PostCard component, PostComposer modal, BibleVerseCard, FeedFilters, PostFeed list with infinite scroll, and EmptyFeedState. Replace the existing feed placeholder page.

Purpose: This is the main screen users interact with after the daily content. It ties together all Wave 2-3 APIs and hooks into a cohesive feed experience.
Output: 1 page, 6 components.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-social/02-RESEARCH.md
@.planning/phases/02-core-social/02-04-SUMMARY.md
@.planning/phases/02-core-social/02-05-SUMMARY.md
@.planning/phases/02-core-social/02-06-SUMMARY.md
@.planning/phases/02-core-social/02-08-SUMMARY.md

@src/app/(app)/feed/page.tsx
@src/hooks/useFeed.ts
@src/hooks/useInfiniteScroll.ts
@src/components/social/LikeButton.tsx
@src/components/social/BookmarkButton.tsx
@src/components/social/ShareButton.tsx
@src/components/social/CommentSection.tsx
@src/components/social/ReportModal.tsx
@src/components/ui/index.ts
@src/lib/utils/cn.ts
@src/lib/bible-api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PostCard, BibleVerseCard, and PostComposer components</name>
  <files>
    src/components/feed/PostCard.tsx
    src/components/feed/BibleVerseCard.tsx
    src/components/feed/PostComposer.tsx
  </files>
  <action>
    **src/components/feed/PostCard.tsx:**
    The main card component for displaying a post in the feed. Props: post object (from API), onDelete callback.

    Layout:
    - Header: Author avatar (link to /profile/[username]), display_name, @username, relative time (use existing relativeTime utility), three-dot menu (edit if own post within deadline, delete if own post, report if other's post)
    - Body: Post text content (with line breaks preserved, URLs linkified)
    - If post has image_url: display image (responsive, max-height, rounded)
    - If post_type is bible_verse: render BibleVerseCard with bible_reference, bible_translation, bible_text
    - If post_type is prayer_request: show prayer badge/indicator
    - Category tag (if category_id): show category name as a small pill/badge
    - "edited" indicator if edited=true
    - Action bar: LikeButton, comment icon with count (links to expand comments or post detail), BookmarkButton, ShareButton
    - Expandable CommentSection (collapsed by default, shows first 2 comments, "View all N comments" link)

    Use Card from UI library. Use cn() for all class merging. Support dark mode with dark: variants. Make entire card clickable to navigate to /post/[id] for detail view (but action buttons stop propagation).

    **src/components/feed/BibleVerseCard.tsx:**
    Styled card-within-card for Bible verse posts. Shows verse text in a decorative style (slightly larger font, italic or serif), bible_reference below (e.g., "John 3:16"), translation badge (e.g., "KJV"). Background: subtle gradient or border accent.

    **src/components/feed/PostComposer.tsx:**
    Modal component for creating or editing a post. Props: isOpen, onClose, editPost? (for editing existing), onPostCreated callback.

    UI:
    - Textarea for post body (max 5000 chars, character counter)
    - Post type selector: Text, Bible Verse, Prayer Request (tabs or radio)
    - If Bible Verse: additional fields for reference (text input), translation (select from BIBLE_TRANSLATIONS constant), verse text (auto-fetched using existing fetchVerseFromBibleApi when reference + translation are set, or manually entered). Show BibleVerseCard preview.
    - If Prayer Request: privacy selector (Public, Followers, Private)
    - Category dropdown (fetched from /api/categories)
    - Image upload button (uses existing presigned upload flow from Phase 1 — GET presigned URL, PUT to B2, pass image_key to create post). Show image preview after upload.
    - Submit button ("Post" or "Save" for edit mode)
    - On submit: POST or PUT to /api/posts, check for errors, close modal, call onPostCreated.
    - Profanity rejection: show inline error message from API response.
  </action>
  <verify>npm run build — no TypeScript errors. Components render in browser.</verify>
  <done>PostCard displays all post types with action buttons. PostComposer supports text/bible_verse/prayer_request creation with image upload.</done>
</task>

<task type="auto">
  <name>Task 2: Create FeedFilters, EmptyFeedState, PostFeed, and feed page</name>
  <files>
    src/components/feed/FeedFilters.tsx
    src/components/feed/EmptyFeedState.tsx
    src/components/feed/PostFeed.tsx
    src/app/(app)/feed/page.tsx
  </files>
  <action>
    **src/components/feed/FeedFilters.tsx:**
    Horizontal filter bar at top of feed. Contains:
    - Category filter: "All" + list of categories (fetched from /api/categories). Scrollable horizontal pill buttons. Active category highlighted.
    - Sort selector: "Newest" / "Most Engaged" toggle or dropdown.
    - Props: currentCategory, currentSort, onCategoryChange, onSortChange, categories (array).
    - Style: sticky at top, clean pill buttons, responsive.

    **src/components/feed/EmptyFeedState.tsx:**
    Shown when feed has zero posts. Displays:
    - Friendly illustration or icon
    - Message: "Your feed is empty! Follow people to see their posts here."
    - "Find People" button (navigates to /search)
    - Follow suggestions section (uses /api/follows/suggestions, renders UserSearchResult cards with FollowButton)

    **src/components/feed/PostFeed.tsx:**
    Main feed list component. Props: category, sort. Uses useFeed hook with category/sort params. Uses useInfiniteScroll for the sentinel element. Renders:
    - PostCard for each post
    - Loading skeleton cards during fetch
    - EmptyFeedState when no posts
    - Sentinel div at bottom with ref from useInfiniteScroll
    - Loading spinner at bottom during next page fetch

    **src/app/(app)/feed/page.tsx:**
    Replace the existing placeholder. Layout:
    - Page title "Feed" (optional, or use clean design without title)
    - Floating action button (FAB) or top-right "+" button to open PostComposer
    - FeedFilters at top
    - PostFeed below filters
    - PostComposer modal (opened by FAB)
    - Fetch categories on mount for filter bar

    'use client' directive. Standard app page pattern.
  </action>
  <verify>
    Navigate to /feed in browser. Verify:
    - Feed loads posts with infinite scroll
    - Filter bar shows categories
    - FAB opens PostComposer
    - Empty state shows when no posts
  </verify>
  <done>Feed page displays filtered, sorted posts with infinite scroll, post creation, and empty state with follow suggestions.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete feed page with PostCard, PostComposer (text + Bible verse + prayer request + image upload), filters, sorting, infinite scroll, and empty state with follow suggestions</what-built>
  <how-to-verify>
    1. Navigate to http://localhost:3000/feed
    2. If feed is empty, verify empty state shows with follow suggestions
    3. Click the create post button — verify PostComposer opens
    4. Create a text post — verify it appears in feed
    5. Create a Bible verse post (select translation, enter reference) — verify BibleVerseCard renders
    6. Try creating a post with profanity — verify rejection message
    7. Like a post — verify heart fills and count updates
    8. Bookmark a post — verify bookmark icon fills
    9. Click share — verify copy link or share sheet
    10. Switch category filter — verify feed updates
    11. Switch sort to "Most Engaged" — verify sort changes
    12. Scroll to bottom — verify infinite scroll loads more
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. Feed page replaces placeholder and loads real data
2. PostCard renders all post types (text, bible verse, prayer request)
3. PostComposer creates posts with all options (type, image, category)
4. FeedFilters switch between categories and sort options
5. Infinite scroll loads next page seamlessly
6. Empty state shows follow suggestions
7. All action buttons (like, comment, bookmark, share) functional
</verification>

<success_criteria>
- Feed page is the functional main social screen
- All post types render correctly with appropriate styling
- PostComposer supports all creation modes including Bible verse lookup
- Image upload works via existing B2 presigned flow
- Filter and sort produce correct results
- Infinite scroll triggers at bottom of list
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-social/02-10-SUMMARY.md`
</output>
