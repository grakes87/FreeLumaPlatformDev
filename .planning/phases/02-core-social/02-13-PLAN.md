---
phase: 02-core-social
plan: 13
type: execute
wave: 4
depends_on: ["02-08", "02-09", "02-10"]
files_modified:
  - src/components/layout/BottomNav.tsx
  - src/components/layout/CreatePicker.tsx
  - src/components/feed/PostComposer.tsx
  - src/app/(app)/post/[id]/page.tsx
  - src/app/(app)/bookmarks/page.tsx
  - src/app/api/users/me/posts/route.ts
autonomous: true

must_haves:
  truths:
    - "Bottom nav has center '+' button (elevated) that opens create picker"
    - "Bottom nav order: Daily | Prayer | Feed | (+) | Studies | Animations | Profile"
    - "'+' button shows overlay: 'Feed Post' or 'Prayer Request'"
    - "PostComposer allows creating posts with text, media (up to 10), @mentions, #hashtags"
    - "PostComposer auto-saves drafts when user navigates away"
    - "Post detail page shows full post with all comments thread"
    - "Bookmarks page shows saved posts with pagination"
    - "Prayer wall tab hidden for positivity mode users"
  artifacts:
    - path: "src/components/layout/BottomNav.tsx"
      provides: "Updated bottom nav with center '+' button"
      exports: ["BottomNav"]
    - path: "src/components/layout/CreatePicker.tsx"
      provides: "Quick picker overlay for create type selection"
      exports: ["CreatePicker"]
    - path: "src/components/feed/PostComposer.tsx"
      provides: "Full-screen post composer with media upload and draft auto-save"
      exports: ["PostComposer"]
    - path: "src/app/(app)/post/[id]/page.tsx"
      provides: "Post detail page with full comments"
      exports: ["default"]
    - path: "src/app/(app)/bookmarks/page.tsx"
      provides: "Bookmarks page"
      exports: ["default"]
  key_links:
    - from: "src/components/layout/BottomNav.tsx"
      to: "src/components/layout/CreatePicker.tsx"
      via: "'+' button opens CreatePicker"
      pattern: "CreatePicker"
    - from: "src/components/feed/PostComposer.tsx"
      to: "src/hooks/useDraft.ts"
      via: "Auto-save draft on navigate away"
      pattern: "useDraft"
    - from: "src/components/feed/PostComposer.tsx"
      to: "src/app/api/posts/route.ts"
      via: "POST to create post"
      pattern: "api/posts"
---

<objective>
Build the bottom navigation update with center '+' create button, full-screen post composer with multi-media upload and draft auto-save, post detail page, and bookmarks page.

Purpose: The create flow is the primary content creation surface. The bottom nav update adds the elevated '+' button per CONTEXT. The post detail page enables deep-linking to specific posts. The bookmarks page lets users access saved content.
Output: 2 updated components, 1 new component, 2 pages, 1 API route.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/02-core-social/02-CONTEXT.md
@.planning/phases/02-core-social/02-10-SUMMARY.md
@.planning/phases/02-core-social/02-08-SUMMARY.md
@.planning/phases/02-core-social/02-09-SUMMARY.md
@src/components/layout/BottomNav.tsx
@src/components/feed/MediaCarousel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update BottomNav with center '+' button and create CreatePicker overlay</name>
  <files>
    src/components/layout/BottomNav.tsx
    src/components/layout/CreatePicker.tsx
  </files>
  <action>
    **src/components/layout/BottomNav.tsx — Update:**
    - Current tab order: Daily, Prayer Wall, Feed, Bible Studies, Animations, Profile
    - New order per CONTEXT: Daily | Prayer | Feed | **(+)** | Studies | Animations | Profile
    - Insert '+' button in center position:
      - Elevated: translate-y-[-12px] or similar to raise above the nav bar
      - Circular: w-14 h-14 rounded-full bg-primary shadow-lg
      - Plus icon inside (lucide-react Plus)
      - On tap: toggle CreatePicker overlay open/close
    - '+' button is NOT a nav link — it opens an overlay, not navigates
    - Keep existing tab configuration (bibleOnly filter for Animations, etc.)
    - Prayer wall tab: add `bibleOnly: true` so it's hidden for positivity mode users (per CONTEXT: prayer wall is bible-mode only)
    - Maintain transparent prop support for daily page
    - The '+' button should NOT highlight as "active" — it's an action button, not a navigation tab

    **src/components/layout/CreatePicker.tsx:**
    - Props: isOpen, onClose, onSelect (type: 'post' | 'prayer_request')
    - Overlay that appears above the bottom nav when '+' is tapped
    - Two large options with icons:
      - "Feed Post" (MessageSquare icon) — default if current route is /feed
      - "Prayer Request" (Heart icon) — default if current route is /prayer-wall
    - Auto-default based on current route (usePathname):
      - On /prayer-wall -> highlight Prayer Request
      - On /feed or elsewhere -> highlight Feed Post
    - On option select: call onSelect(type), close picker
    - Backdrop: semi-transparent overlay, tap to close
    - Animation: slide up + fade in
    - cn() for styling, dark mode
  </action>
  <verify>
    - `npm run build` passes
    - Bottom nav shows '+' button in center position
    - Tapping '+' shows CreatePicker overlay with two options
    - Prayer wall tab hidden for positivity mode
    - Tab order matches CONTEXT specification
  </verify>
  <done>Bottom nav updated with elevated center '+' button. CreatePicker overlay shows Feed Post / Prayer Request selection. Prayer wall tab hidden for positivity mode. Tab order matches CONTEXT.</done>
</task>

<task type="auto">
  <name>Task 2: Create PostComposer, post detail page, bookmarks page, and user posts API</name>
  <files>
    src/components/feed/PostComposer.tsx
    src/app/(app)/post/[id]/page.tsx
    src/app/(app)/bookmarks/page.tsx
    src/app/api/users/me/posts/route.ts
  </files>
  <action>
    **src/components/feed/PostComposer.tsx:**
    - Full-screen composer UI (slides up, covering entire screen per CONTEXT)
    - Props: isOpen, onClose, onPostCreated, editPost? (for editing existing post)
    - Uses useDraft('post') for auto-save
    - Layout:
      - Header: "New Post" (or "Edit Post") + close (X) button + "Post" submit button (disabled if body empty)
      - User's avatar + display name (from auth context)
      - Textarea: placeholder "What's on your mind?" — auto-grow, max 5000 chars
      - Character count indicator when > 4500 chars
      - @mention support: typing @ shows user search dropdown (inline), select inserts @username
      - #hashtag: typing # auto-styles text in blue (visual only, no dropdown)
      - Media attachment area:
        - "Add Photo" and "Add Video" buttons (or combined camera/gallery button)
        - Upload via presigned URL flow (GET /api/upload/post-media, PUT to B2)
        - Show horizontal thumbnail strip of attached media (up to 10)
        - Each thumbnail has X remove button
        - Show upload progress per item
        - Video: show duration badge, enforce 5-min max (client-side check before upload)
      - Visibility selector: Public / Followers Only (radio buttons or segmented control)
    - On submit:
      - POST to /api/posts with body, media_keys, visibility
      - Clear draft on success
      - Call onPostCreated callback with new post data
      - Close composer with success animation
    - Edit mode: populate body and media from editPost, PUT on submit instead of POST
    - Auto-save: useDraft saves body + media_keys + metadata on change (2s debounce)
    - On close (not submit): save draft automatically
    - cn() for styling, dark mode

    **src/app/(app)/post/[id]/page.tsx:**
    - Post detail page (deep-linkable)
    - Fetches GET /api/posts/[id] for full post data
    - Shows full PostCard (Instagram style, regardless of feed_style setting)
    - Below: full comment thread (NOT bottom sheet — inline on the page)
    - Uses usePostComments for comment loading
    - Comment input at bottom of page (fixed)
    - If post is a repost: show embedded original post
    - If post is deleted (404): show "Post not found" message
    - Back button in top bar

    **src/app/(app)/bookmarks/page.tsx:**
    - Page title: "Saved"
    - Fetches GET /api/bookmarks
    - Shows bookmarked posts as a list (Instagram card style)
    - Each item has unbookmark button
    - Empty state: "No saved posts yet. Bookmark posts to see them here!"
    - Infinite scroll with cursor pagination
    - Filter tabs: All | Posts | Daily Content

    **src/app/api/users/me/posts/route.ts — GET:**
    - withAuth
    - Fetch posts WHERE user_id = requesting user AND deleted_at IS NULL
    - Cursor-based pagination
    - Include author, media, reaction counts, comment counts
    - Optional query param: include_reposts (boolean) — if true, also include posts that are quote reposts by this user
    - Return { posts, next_cursor, has_more }
  </action>
  <verify>
    - `npm run build` passes
    - PostComposer opens full-screen, creates post with text and media
    - Post detail page loads and shows full post with inline comments
    - Bookmarks page shows saved posts
    - Draft auto-save works (navigate away, come back, draft restored)
  </verify>
  <done>PostComposer with multi-media upload (up to 10), @mention search, auto-save drafts, edit mode. Post detail page with inline comments. Bookmarks page with filters. User posts API for profile tabs.</done>
</task>

</tasks>

<verification>
- Bottom nav '+' button is elevated and opens create picker
- Create picker defaults based on current section
- PostComposer creates posts with text and multi-media
- Draft auto-saves and restores
- Post detail page shows full post with comment thread
- Bookmarks page shows saved posts with unbookmark
- User posts API returns paginated posts for profile
</verification>

<success_criteria>
- Updated bottom nav with center '+' button
- Create flow with type selection
- Full-screen post composer with media upload
- Draft auto-save on navigate away
- Post detail deep-link page
- Bookmarks page with filters
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-social/02-13-SUMMARY.md`
</output>
