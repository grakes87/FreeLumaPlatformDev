---
phase: 02-core-social
plan: 12
type: execute
wave: 4
depends_on: [02-06, 02-09]
files_modified:
  - src/app/(app)/categories/page.tsx
  - src/app/(app)/categories/[slug]/page.tsx
  - src/components/categories/CategoryGrid.tsx
  - src/components/categories/CategoryCard.tsx
  - src/components/categories/CategoryFeed.tsx
autonomous: true

must_haves:
  truths:
    - "User can view list of categories in a grid layout"
    - "User can browse a category-specific feed of posts"
    - "User can subscribe to a category from the browse page"
    - "Category feed uses cursor-based pagination"
  artifacts:
    - path: "src/app/(app)/categories/page.tsx"
      provides: "Category browse page"
      min_lines: 20
    - path: "src/app/(app)/categories/[slug]/page.tsx"
      provides: "Category-specific feed page"
      min_lines: 20
    - path: "src/components/categories/CategoryGrid.tsx"
      provides: "Category grid layout component"
      min_lines: 15
    - path: "src/components/categories/CategoryCard.tsx"
      provides: "Single category tile component"
      min_lines: 15
  key_links:
    - from: "src/app/(app)/categories/[slug]/page.tsx"
      to: "src/hooks/useFeed.ts"
      via: "useFeed with category filter"
      pattern: "useFeed"
    - from: "src/components/categories/CategoryCard.tsx"
      to: "/api/categories/[slug]/subscribe"
      via: "subscription toggle"
      pattern: "fetch.*subscribe"
---

<objective>
Build the category browsing pages: category grid listing, individual category feed pages, and category subscription from the browse view.

Purpose: Categories organize content by topic (Prayer Requests, Testimony, etc.). Users can browse category feeds and subscribe to topics they're interested in. This provides content discovery beyond the followed-user feed.
Output: 2 pages, 3 components.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-social/02-RESEARCH.md
@.planning/phases/02-core-social/02-06-SUMMARY.md
@.planning/phases/02-core-social/02-09-SUMMARY.md

@src/app/api/categories/route.ts
@src/hooks/useFeed.ts
@src/hooks/useInfiniteScroll.ts
@src/components/feed/PostCard.tsx
@src/components/feed/PostFeed.tsx
@src/lib/db/models/Category.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CategoryCard, CategoryGrid components, and categories browse page</name>
  <files>
    src/components/categories/CategoryCard.tsx
    src/components/categories/CategoryGrid.tsx
    src/app/(app)/categories/page.tsx
  </files>
  <action>
    **src/components/categories/CategoryCard.tsx:**
    Tile component for a single category. Props: category (id, name, slug, description, icon, is_subscribed, post_count). Displays:
    - Category name (prominent)
    - Description (if exists, truncated)
    - Post count: "N posts"
    - Subscribe/Unsubscribe button (small, toggles via POST /api/categories/[slug]/subscribe)
    - Entire card links to /categories/[slug]
    - Use Card from UI library. Use category icon if available (from lucide-react, map category name to icon). Support dark mode.

    **src/components/categories/CategoryGrid.tsx:**
    Responsive grid of CategoryCard components. Props: categories (array). Grid layout: 2 columns on mobile, 3 on md, 4 on lg. Gap spacing.

    **src/app/(app)/categories/page.tsx:**
    'use client'. Fetches categories from GET /api/categories on mount. Renders:
    - Page header: "Categories"
    - CategoryGrid with all categories
    - Loading skeletons while fetching
    - Handle subscription toggle: optimistically update is_subscribed on the category
  </action>
  <verify>Navigate to /categories — grid of categories renders with subscribe buttons.</verify>
  <done>Categories page shows grid of categories with subscription toggle and post counts.</done>
</task>

<task type="auto">
  <name>Task 2: Create CategoryFeed component and category feed page</name>
  <files>
    src/components/categories/CategoryFeed.tsx
    src/app/(app)/categories/[slug]/page.tsx
  </files>
  <action>
    **src/components/categories/CategoryFeed.tsx:**
    Feed component filtered to a specific category. Props: categorySlug (string), categoryName (string). Uses useFeed hook with category param set to the slug, feedType set to 'all' (show all public posts in this category, not just followed users). Renders PostCard list with useInfiniteScroll. Shows loading skeletons, empty state ("No posts in this category yet").

    **src/app/(app)/categories/[slug]/page.tsx:**
    'use client'. Dynamic route for category-specific feed. On mount: fetch category info by slug from /api/categories (or extract from route). Renders:
    - Back button to /categories
    - Category name as page title
    - Subscribe/Unsubscribe button for this category
    - CategoryFeed component with the slug
    - If category not found: show 404-style message
  </action>
  <verify>
    Navigate to /categories/prayer-requests — should show posts tagged with that category.
    Subscribe button toggles subscription status.
  </verify>
  <done>Category-specific feed page shows filtered posts with subscription toggle and infinite scroll.</done>
</task>

</tasks>

<verification>
1. /categories page shows grid of all categories
2. Each category card shows name, description, post count, subscribe button
3. Subscribe toggle works optimistically
4. /categories/[slug] shows filtered feed of posts in that category
5. Category feed uses feed_type='all' (not just followed users)
6. Infinite scroll works on category feed
7. Empty state shown for categories with no posts
</verification>

<success_criteria>
- Category browse page provides discovery interface
- Category-specific feeds show all public posts (not limited to followed)
- Subscription toggle uses existing UserCategory model
- Category feeds reuse PostCard and useFeed infrastructure
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-social/02-12-SUMMARY.md`
</output>
